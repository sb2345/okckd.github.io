
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Woodstock Blog</title>
  <meta name="author" content="Charlie Brown">

  
  <meta name="description" content="Question link Let&rsquo;s say I gave you a long String and I wanted you to tell me the most common word in that String. How would you do that? Follow &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://okckd.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Woodstock Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52495723-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Woodstock Blog</a></h1>
  
    <h2>What's the good of living if you don't try a few things?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:okckd.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/09/most-frequent-word-from-book/">[Question] Most Frequent Word From a Book</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/09/most-frequent-word-from-book/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/09/most-frequent-word-from-book/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.careercup.com/question?id=5715664853532672">link</a></p>

<blockquote><p>Let&rsquo;s say I gave you a long String and I wanted you to tell me the most common word in that String. How would you do that?</p>

<p>Follow-up: how about if I gave you the entire works of Alexandre Dumas, one of the most prolific authors in history. How would your solution work? How could you change it to solve this more specific problem?</p></blockquote>

<h3>Solution</h3>

<p>There are 2 solutions. Either <strong>HashMap</strong> or <strong>Trie</strong>. It&rsquo;s easy to think of first, but remember that Trie is designed to do this kind of job.</p>

<blockquote><p>A trie will be more useful in the second situation where you will have millions of words. You can have a counter at every node to see its frequency</p></blockquote>

<p><strong>Now the follow up</strong>. For big data problems, we can always do <strong>divide and conquer</strong> by hash value.</p>

<p>Alternatively, the comment by <a href="http://www.careercup.com/question?id=5715664853532672">Prince</a> mentioned how to solve with <strong>Map Reduce</strong>:</p>

<blockquote><p>Instead of loading it as a string first I would stream data so that I avoid memory spike. Further our map size might increases as new words are added to it. Also, we can use map reduce type job were we create map&lt;word, frequency> of each play in parallel and later join/collapse them this will reduce the time it will take to get result.</p>

<p>Common phrase should be no different then above algorithm. However we need to rebuild our index with &lt;phase, frequency></p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/09/match-triplet-with-reverse-order/">[Question] Match Triplet With Reverse Order</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/09/match-triplet-with-reverse-order/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/09/match-triplet-with-reverse-order/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.careercup.com/question?id=11655778">link</a></p>

<blockquote><p>Find the substring of length 3 which is present in the reverse order from the string.</p>

<p>Ex: if the string is abcdcba (cba is the reverse of abc) so we should return cba.</p></blockquote>

<h3>Solution</h3>

<ol>
<li><p><strong>HashMap (recommended)</strong>. Hash all substrings of length 3. O(n). Look up all reverse substrings of length 3 in this hash set. O(n) time and O(n) space.</p></li>
<li><p><strong>KMP Algo</strong>. Take every substring of length 3. Reverse it and find it in the input using KMP. O(n<sup>2</sup>) time and O(1) space.</p></li>
<li><p><strong>Build suffix tree</strong> of height 3. Then in reverse order, check triplets.</p></li>
</ol>


<p>The 3 solutions above all work well. Pick the one you love.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/09/longest-common-substring/">[Question] Longest Common Contiguous Intersection (Longest Common Substring)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/09/longest-common-substring/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/09/longest-common-substring/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.careercup.com/question?id=12862670">link</a></p>

<blockquote><p>Write Program to find longest common contiguous intersection from 2 lists provided to the function.</p>

<p>Example: list1: abcrfghwetf</p>

<p>list2: abrfghwwetxyab</p>

<p>Ans: rfghw</p></blockquote>

<h3>Solution</h3>

<p>This is a classic <a href="http://en.wikipedia.org/wiki/Longest_common_substring_problem">Longest common substring</a> problem.</p>

<p>Solution 1: <strong>Suffix tree</strong>. Building the tree is O(n) time and the whole program is O(n + m) time.</p>

<p>Solution 2: <strong>DP</strong>, which takes O(nm) time and space. The code for DP is posted below.</p>

<h3>Code</h3>

<p><strong>dp</strong></p>

<pre><code>public String LCSubstr(String s, String t) {
    int longest = 0;
    int tPos = -1;

    // dp[i][j] represents the LCSubstr ending at position i and j
    int[][] dp = new int[t.length() + 1][s.length() + 1];
    for (int i = 1; i &lt;= t.length(); i++) {
        for (int j = 1; j &lt;= s.length(); j++) {
            if (t.charAt(i - 1) == s.charAt(j - 1)) {
                dp[i][j] = dp[i - 1][j - 1] + 1;
                if (dp[i][j] &gt; longest) {
                    longest = dp[i][j];
                    tPos = i;
                }
            }
        }
    }
    return t.substring(tPos - longest, tPos);
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/08/number-of-distinct-substrings/">[Google] Number of Distinct Substrings</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/08/number-of-distinct-substrings/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/08/number-of-distinct-substrings/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.quora.com/Given-a-string-how-do-I-find-the-number-of-distinct-substrings-of-the-string">link</a></p>

<blockquote><p>Given a string, find the number of distinct substrings of the string. Example:</p>

<p>input = &ldquo;aaaa&rdquo;,</p>

<p>output = 4 (the 4 substrings are &ldquo;a&rdquo;, &ldquo;aa&rdquo;, &ldquo;aaa&rdquo;, &ldquo;aaaa&rdquo;)</p>

<p>input = &ldquo;abcd&rdquo;,</p>

<p>output = 10 (&ldquo;a&rdquo;, &ldquo;b&rdquo;, &ldquo;c&rdquo;, &ldquo;d&rdquo;, &ldquo;ab&rdquo;, &ldquo;bc&rdquo;, &ldquo;cd&rdquo;, &ldquo;abc&rdquo;, &ldquo;bcd&rdquo;, &ldquo;abcd&rdquo;)</p>

<p>input = &ldquo;banana&rdquo;,</p>

<p>output = 15 (&ldquo;a&rdquo;, &ldquo;an&rdquo;, &ldquo;ana&rdquo;, &ldquo;anan&rdquo;, &ldquo;anana&rdquo;, &ldquo;b&rdquo;, &ldquo;ba&rdquo;, &ldquo;ban&rdquo;, &ldquo;bana&rdquo;, &ldquo;banan&rdquo;, &ldquo;banana&rdquo;, &ldquo;n&rdquo;, &ldquo;na&rdquo;, &ldquo;nan&rdquo;, &ldquo;nana&rdquo;)</p></blockquote>

<p>This is also a question on <a href="http://www.spoj.com/problems/DISUBSTR/">SPOJ</a>.</p>

<h3>Solution</h3>

<p>This is a very good question, which tests Suffix tree, LCP and string manipulation knowledges.</p>

<p><strong>The solution is to build a suffix tree</strong>. This is because:</p>

<blockquote><p>If you look through the <strong><a href="http://qr.ae/6o6Nk">prefixes of each suffix</a></strong> of a string, you have covered all substrings of that string.</p></blockquote>

<p>There are 2 implementations. First one is slightly simpler.</p>

<h4>Implementation 1</h4>

<p><strong>Suffix array + LCP</strong> (longest common prefix). Take &ldquo;Banana&rdquo; as input, then the suffixes:</p>

<pre><code>0) BANANA
1) ANANA
2) NANA
3) ANA
4) NA
5) A
</code></pre>

<p>Sort it:</p>

<pre><code>5) A
3) ANA
1) ANANA
0) BANANA
4) NA
2) NANA
</code></pre>

<p>Then we start calculate number of substring (that is prefixes of suffix). After removing duplicated prefix, the count is:</p>

<pre><code>5) A - 1
3) ANA - 2
1) ANANA - 2
0) BANANA - 6
4) NA - 2
2) NANA - 2
</code></pre>

<p>Total number is:</p>

<pre><code>1 + 2 + 2 + 6 + 2 + 2 = 15
</code></pre>

<p>But wait, realize something? &ldquo;A&rdquo; is simply duplicate substring in &ldquo;ANA&rdquo;, which appers in &ldquo;ANANA&rdquo;. Keep this in mind, cuz we need to observe this in the 2nd implementation, too.</p>

<p>Finally, the total number is calculated like this:</p>

<pre><code>for each suffix
    ans += length(suffix) - LCP(suffix, previous suffix)
</code></pre>

<p>For more details, read <a href="http://qr.ae/6o6Nk">here</a>.</p>

<h4>Implementation 2</h4>

<p>Build a suffix tree, like this:</p>

<p><img class="middle" src="/assets/images/suffix-tree-banana.png"></p>

<p>Number of substrings is simply the <strong>sum of levels of each leaf</strong>. For the 3 branches of the suffix tree, number of levels are: 6, 5 and 4 respectively. Total = 15.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/08/all-number-given-decimal-scale/">[Google] Check All Numbers Given the Decimal Scale</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/08/all-number-given-decimal-scale/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/08/all-number-given-decimal-scale/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.mitbbs.com/article_t/JobHunting/32859887.html">link</a></p>

<blockquote><p>检查一个字符串是否包含k位a进制数的所有表示形式。</p>

<p>保证原字符串的所有字串都是合法的k位a进制数。</p>

<p>&ldquo;00110, a=2, k=2&rdquo; => true （包括了00，01，10，11）</p></blockquote>

<h3>Solution</h3>

<p>First find all substrings with length == k, then generate all numbers in a scale. This is not a difficult question.</p>

<p>We may want to score the substrings in a HashMap/HashSet. <strong>The hashing procedure is preferrably using <a href="http://en.wikipedia.org/wiki/Rolling_hash">Rolling hash</a></strong>.</p>

<blockquote><p>Rolling Hash</p>

<p>A rolling hash is a hash function where the input is hashed in a window that moves through the input.</p>

<p>A few hash functions allow a rolling hash to be computed very quickly—the new hash value is rapidly calculated given only the old hash value, the old value removed from the window, and the new value added to the window—similar to the way a moving average function can be computed much more quickly than other low-pass filters.</p></blockquote>

<p>The people in the origin post &ndash; they discuss about &ldquo;<strong>slide window check</strong>&rdquo; algorithm. I do not understand what&rsquo;s the benefit of this. If you read this and would like to help me, please leave a comment. Thanks!</p>

<h3>A similar question</h3>

<p><a href="http://www.mitbbs.com/article_t/JobHunting/32860321.html">This</a> is simply the reverse of the question above:</p>

<blockquote><p>给出最短的字符串, which is used to 表示k位a进制数的所有表示形式.</p></blockquote>

<p>This question is solved using <strong><a href="http://en.wikipedia.org/wiki/De_Bruijn_sequence">De Bruijn sequence</a></strong>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/07/scheduling-jobs-with-max-cost/">[Facebook] Scheduling Jobs With Max Cost</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-07T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/07/scheduling-jobs-with-max-cost/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/07/scheduling-jobs-with-max-cost/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.glassdoor.com/Interview/Given-a-set-of-n-jobs-with-start-time-end-time-cost-find-a-subset-so-that-no-2-jobs-overlap-and-the-cost-is-maximum-QTN_440168.htm">link</a></p>

<blockquote><p>Given a set of n jobs with [start time, end time, cost], find a subset so that no 2 jobs overlap and the cost is maximum.</p>

<p>Let&rsquo;s assume the input is already sorted by start_time.</p></blockquote>

<h3>Solution</h3>

<p><a href="http://cs.stackexchange.com/a/14237">Somebody</a> mentioned <strong>Interval Graph</strong>, so check it out if you interested!</p>

<p>I am going to discuss both DP and recursive solution.</p>

<p>This question reminds me of <strong>[Question] 0-1 Knapsack Problem</strong> and <strong>[Question] Coin Change Problem</strong>, cuz the basic idea is to compare 2 conditions:</p>

<ol>
<li>include current element</li>
<li>or, not include current element</li>
</ol>


<p>A very good DP solution is presented in <a href="http://cs.stackexchange.com/a/16842">here</a>. The code below is written by me and it&rsquo;s very intuitive to read.</p>

<p>Leave me a comment if you have questions. And one more thing~ Happy new year!</p>

<h3>Code</h3>

<p>Dp</p>

<pre><code>private int dpSolution(Job[] jobs, int size) {
    int[] dp = new int[size];
    dp[size - 1] = jobs[size - 1].cost;
    // cost of last job equals to just itself
    for (int k = size - 2; k &gt;= 0; k--) {
        int next = findNextJob(jobs, k);
        int includeK = jobs[k].cost;
        if (next &lt; size) {
            includeK += dp[next];
        }
        int excludeK = dp[k + 1];
        dp[k] = Math.max(includeK, excludeK);
    }
    return dp[0];
}

private int findNextJob(Job[] jobs, int k) {
    int finishTime = jobs[k].finish;
    int next = k + 1;
    while (next &lt; jobs.length) {
        if (jobs[next].start &lt; finishTime) {
            next++;
        } else {
            break;
        }
    }
    return next;
}
</code></pre>

<p>Recursion</p>

<pre><code>public int recursiveSolution(Job[] jobs, int size, int k) {
    // max cost from (k)th job and onwards
    if (k == size) {
        return 0;
    }
    // (k)th job must not conflict with any previous job
    int next = findNextJob(jobs, k);
    int includeK = jobs[k].cost + recursiveSolution(jobs, size, next);
    int excludeK = recursiveSolution(jobs, size, k + 1);
    return Math.max(includeK, excludeK);
}

private int findNextJob(Job[] jobs, int k) {
    int finishTime = jobs[k].finish;
    int next = k + 1;
    while (next &lt; jobs.length) {
        if (jobs[next].start &lt; finishTime) {
            next++;
        } else {
            break;
        }
    }
    return next;
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/07/P2P-technology/">[Design] P2P Technology</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-07T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/07/P2P-technology/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/07/P2P-technology/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Overview</h3>

<p><strong><a href="http://en.wikipedia.org/wiki/Peer-to-peer">Peer-to-peer</a> (P2P) networking</strong> is a distributed application architecture that partitions tasks or work loads between peers.</p>

<p>Peers are <strong>both suppliers and consumers</strong> of resources, in contrast to the traditional client-server model where communication is usually to and from a central server. A typical example of a file transfer that uses the client-server model is the <strong>File Transfer Protocol</strong> (FTP) service in which the client and server programs are distinct: the clients initiate the transfer, and the servers satisfy these requests.</p>

<p>This architecture was popularized by the file sharing system Napster, originally released in 1999.</p>

<h4>Precedure</h4>

<ol>
<li>Alice run P2P client software.

<ol>
<li>connect to Internet and get new IP address for each connection</li>
<li>register her files in P2P system</li>
<li>request &ldquo;Harry Potter&rdquo;</li>
<li>find other peers who have the copy</li>
<li>choose one and copy to her PC.</li>
<li>meanwhile, Alice is servig her files for other people</li>
</ol>
</li>
<li>Act like a server</li>
<li>Act like a client</li>
<li>User keyword to search content (like google)</li>
</ol>


<h3>P2P Types</h3>

<ol>
<li><p>Unstructured P2P: <strong>no coupling between nodes and file location</strong></p>

<ol>
<li>Napster</li>
<li>Gnutella</li>
<li>KaZaA</li>
</ol>
</li>
<li><p>Structured P2P: <strong>tight coupling between nodes and file location</strong></p>

<ol>
<li>DHT</li>
</ol>
</li>
</ol>


<h4>Napster</h4>

<p>Register at Napster server.</p>

<p>Centralized search, and P2P distributing.</p>

<h4>Gnutella</h4>

<p><strong>Decentralized</strong> design for searching:</p>

<ol>
<li>No central directory server</li>
<li>Each node maintain a list of neighbors (overlay network)</li>
</ol>


<p><strong>Search by flooding</strong>:</p>

<ol>
<li>BFS traversal.</li>
<li>Define maximum number of hops</li>
<li>Expanded-ring TTL search means to try 1 hop first, then try 2 hops, then 3&hellip;</li>
</ol>


<p>Join nodes:</p>

<ol>
<li>Use Bootstrap node to get some IP addresses</li>
<li>Join these IP, which becomes neighbors.</li>
</ol>


<p>Shortcomings:</p>

<ol>
<li>Flooding is <strong>NOT a scalable design</strong>.</li>
<li>Download may not complete.</li>
<li>Possibility of search failure, even then the resource presents.</li>
</ol>


<h4>KaZaA</h4>

<p>Combines Napster and Gnutella.</p>

<p>Each peer is a supernode or assigned to a supernode. Each supernode connects to 30~50 other supernodes. The supernode acts like a mini-Napster hub.</p>

<p>At registration, a PC connects to a supernode. If a supernode goes down, obtains updated list and elect another one.</p>

<p>Search within supernode, then in other supernodes. If found many nodes holding the file, do parallel downloading.</p>

<p>Automatic recovery if 1 server peer goes down. Use <strong>ContentHash</strong> to search.</p>

<h4>Structured P2P</h4>

<p>For Distributed HashTable services, refer to <strong>[Design] Distributed hash table</strong>.</p>

<h3>Conclusion</h3>

<ol>
<li><p>Unstructured P2P:</p>

<ol>
<li><strong>no coupling between nodes and file location</strong></li>
<li>Centralized direcotry service (except Gnutella)</li>
<li>Search by flooding (overhead)</li>
<li>Hierarchical architecture (non-scalable)</li>
</ol>
</li>
<li><p>Structured P2P:</p>

<ol>
<li><strong>tight coupling between nodes and file location</strong></li>
<li>DHT using consistent hashing (eg. Chord, and many other types)</li>
<li>A node is assigned to hold particular content</li>
<li>Search with more efficiency</li>
</ol>
</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/06/distributed-hash-table/">[Design] Distributed Hash Table</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-06T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/06/distributed-hash-table/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/06/distributed-hash-table/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://blog.csdn.net/yfkiss/article/details/6977509">ref</a></p>

<h3>Distributed hash table</h3>

<p><strong>A <a href="http://en.wikipedia.org/wiki/Distributed_hash_table">distributed hash table</a> (DHT) is a class of a decentralized distributed system</strong> that provides a lookup service similar to a hash table. (key,value) pairs are stored in a DHT, and any participating node can efficiently retrieve the value associated with a given key.</p>

<p>对于一个key/value对，DHT在分布式集群中，提供像HashTable一样的服务，例如简单快捷的存取、查询。</p>

<p><img class="middle" src="/assets/images/DHT.png"></p>

<p>DHTs form an infrastructure that can be used to build more complex services, such as anycast, cooperative Web caching, distributed file systems, domain name services, instant messaging, multicast, and also <strong>peer-to-peer file sharing</strong> and content distribution systems.</p>

<h4>Properties</h4>

<p>Unlike unstructured P2P, <strong>DHT is tightly coupled between nodes and file locations</strong>. (when request a content, directly go to the content instead of <strong>searching by flooding</strong>)</p>

<p>DHT has the following properties:</p>

<ol>
<li><p><strong>Autonomy and Decentralization</strong>: the nodes collectively form the system without any central coordination.</p></li>
<li><p><strong>Fault tolerance</strong>: the system should be reliable (in some sense) even with nodes continuously joining, leaving, and failing.</p></li>
<li><p><strong>Scalability</strong>: the system should function efficiently even with thousands or millions of nodes.</p></li>
</ol>


<h4>Building a DHT</h4>

<ol>
<li>Hash function that maps a file to a unique ID. Eg. hash(&ldquo;Harry Potter&rdquo;) &ndash;> 3912.</li>
<li>Distribute <strong>range space</strong> for all nodes in the network.</li>
<li>The desinated node stores the location of the file. (this is indirect approach)</li>
</ol>


<p><img class="middle" src="/assets/images/range-space.PNG"></p>

<h4>Search in DHT</h4>

<ol>
<li>Search query <strong>routed to the node whose range covers the file</strong>.</li>
<li>Each node would retains a <strong>routing information</strong> that is implemented in a fully distributed manner (i.e. no central point, no single point of failure).</li>
</ol>


<p>There is different hashing and routing techniques associated with DHT. The most important is <strong>Consistent Hashing</strong> and <strong>Chord Routing</strong>.</p>

<h3>Consistent Hashing</h3>

<p>&mdash;<a href="http://en.wikipedia.org/wiki/Consistent_hashing">Consistent hashing</a><strong> is a special kind of hashing such that when a hash table is resized and consistent hashing is used, </strong>only K/n keys need to be remapped__ on average, where K is the number of keys, and n is the number of slots.</p>

<h4>Motivation</h4>

<p>In most traditional hash tables, a change in the number of array slots causes <strong>nearly all keys</strong> to be remapped. Specifically, <a href="http://blog.csdn.net/sparkliang/article/details/5279393">the 3 cases below</a> can end up in a technology crisis:</p>

<ol>
<li><p>leaves/failures &ndash; 一个 cache 服务器 m down 掉了（在实际应用中必须要考虑这种情况），这样所有映射到 cache m 的对象都会失效，怎么办，需要把 cache m 从 cache 中移除，这时候 cache 是 N-1 台，映射公式变成了 hash(object)%(N-1)；</p></li>
<li><p>join &ndash; 由于访问加重，需要添加 cache ，这时候 cache 是 N+1 台，映射公式变成了 hash(object)%(N+1)</p></li>
<li><p>scalability &ndash; 由于硬件能力越来越强，你可能想让后面添加的节点多做点活，显然上面的 hash 算法也做不到。</p></li>
</ol>


<h4>Technique</h4>

<p>Consistent hashing is based on mapping each object to a point on the edge of a circle. The system maps each available machine to pseudo-randomly distributed points on the edge of the same circle.</p>

<ol>
<li>假定哈希key均匀的分布在一个环上</li>
<li>所有的节点也都分布在同一环上</li>
<li>每个节点只负责一部分Key，当节点加入、退出时只影响加入退出的节点和其邻居节点或者其他节点只有少量的Key受影响</li>
</ol>


<p>For a very detailed steps of consistent hashing, read <a href="http://blog.csdn.net/sparkliang/article/details/5279393">this Chinese blog</a>.</p>

<p><img class="middle" src="/assets/images/consistent-hashing.PNG"></p>

<p>In this way, 一致性Hash在node加入/离开时，不会导致映射关系的重大变化。</p>

<h3>Routing (searching)</h3>

<p><strong>Simple Routing</strong> would search successor node, and runtime is linear. These node would keep O(1) <strong>routing information</strong>, and spend O(n) time in <strong>query routing</strong>.</p>

<p>Otherwise, we make every node store ID and IP of all nodes, thus query routing takes O(1) but routing information is O(n).</p>

<p>We&rsquo;ll now discuss <strong>Chord Routing</strong>.</p>

<h4>Chord Routing</h4>

<p>Each node stores more info <strong>closely following it</strong> on the identifier circle than nodes further away. That is, the subsequent nodes at position 1, 2, 4, 8, 16, 32&hellip; (each entry is called a <strong>finger</strong>)</p>

<p><img class="middle" src="/assets/images/chord-routing.PNG"></p>

<p>为网络中每个Node分配一个唯一id（可以通过机器的mac地址做Hash），假设整个网络有N 个节点，我们可以认为这些整数首尾相连形成一个环，称之为Chord环。两个节点间的距离定义为节点间下标差，每个节点会存储一张路由表(Finger表)，表内顺时针按照离本节点2、4、8、16、32.……2i的距离选定log2N个其他节点的ip信息来记录。</p>

<p><strong>Routing information</strong> maintained at each node: O(logN).</p>

<p><strong>Query routing</strong> take O(logN) time.</p>

<h3>Join and leave in Chord</h3>

<p>It&rsquo;s very much like insertion and removal in Doubly Linked List. Read it yourself.</p>

<p><img class="middle" src="/assets/images/join-in-chord.PNG"></p>

<p>Special thanks to the online resources written by some CSDN bloggers.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/06/cloud-grid-cluster/">[Design] Cloud, Grid and Cluster</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-06T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/06/cloud-grid-cluster/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/06/cloud-grid-cluster/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://stackoverflow.com/questions/9723040/what-is-the-difference-between-cloud-grid-and-cluster">ref</a></p>

<h3>Cluster VS. Grid</h3>

<p><strong><a href="http://stackoverflow.com/a/9753568">Cluster differs</a> from Cloud and Grid in that</strong></p>

<ol>
<li>a cluster is a group of computers connected by a local area network (LAN)</li>
<li>cloud and grid are more wide scale and can be geographically distributed.</li>
</ol>


<p>Another way to put it is to say that</p>

<ol>
<li>a cluster is tightly coupled</li>
<li>a Grid or a cloud is loosely coupled.</li>
</ol>


<p>Also, <strong>the hardware</strong>:</p>

<ol>
<li>clusters are made up of machines with similar hardware</li>
<li>clouds and grids are made up of machines with possibly very different hardware configurations.</li>
</ol>


<h3>Computer cluster</h3>

<p><strong><a href="http://en.wikipedia.org/wiki/Computer_cluster">A computer cluster</a></strong> consists of a set of tightly connected computers that work together as a single system.</p>

<p>Unlike grid computers, computer clusters have each node set to <strong>perform the same task</strong>, controlled and scheduled by software.</p>

<p>In most circumstances, all of the nodes use the <strong>same hardware and OS</strong>. They are connected in <strong>LAN</strong> with each node running its <strong>own piece</strong> of OS.</p>

<p>They are used to improve <strong>performance</strong> and <strong>availability</strong> over that of a single computer, while being more <strong>cost effective</strong>.</p>

<p>Computer clusters emerged as a result of:</p>

<ol>
<li>low-cost microprocessors,</li>
<li>high-speed networks,</li>
<li>software for high-performance distributed computing</li>
</ol>


<h3>Grid computing</h3>

<p><strong><a href="http://en.wikipedia.org/wiki/Grid_computing">Grid computing</a></strong> is the collection of computer resources from multiple locations to reach a common goal. Each computer have <strong>non-interactive workloads</strong>. It&rsquo;s like a <strong>&ldquo;super virtual computer”</strong> composed of many networked loosely coupled computers acting together to perform large tasks.</p>

<p>Unlike conventional high performance computing systems such as <strong>cluster computing</strong>, grid computers have each node set to <strong>perform a different task</strong>.</p>

<p>Grid computers also tend to be more <strong>geographically dispersed</strong> than cluster computers. Grids are often constructed with general-purpose grid middleware software libraries.</p>

<p>Major disadvantage with Grid Computing is, <strong>if one piece of software on a node fails</strong>, other pieces of the software on the other nodes may fail.</p>

<h3>Cloud computing</h3>

<p><strong><a href="http://en.wikipedia.org/wiki/Cloud_computing">Cloud computing</a></strong> is terminology based on utility and <strong>consumption of computing resources</strong>.</p>

<h4>SaaS</h4>

<p>An application doesn&rsquo;t access resources it requires directly, rather it accesses them through <strong>something <a href="http://stackoverflow.com/a/1068133">like a service</a></strong>. Instead of talking to a specific hard drive for storage, and a specific CPU for computation, etc, it talks to some <strong>service that provides these resources</strong>. The service then maps any requests for resources to its physical resources.</p>

<p>The services themselves <a href="http://stackoverflow.com/a/9753568">have long been referred to</a> as <strong>Software as a Service (SaaS)</strong>. The datacenter hardware and software is what we call <strong>a Cloud</strong>. When a Cloud is made available in a pay-as-you-go manner to the general public, we call it a <strong>Public Cloud</strong>; the service being sold is <strong>Utility Computing</strong>.</p>

<h4>Sharing of Resources</h4>

<p>Usually the service <strong>dynamically allocate resources</strong> to maximize the effectiveness of the shared resources(per users and per demand).</p>

<p>For example, a cloud computer facility that serves European users during European business hours with a specific application (e.g., email) may reallocate the same resources to serve North American users during North America&rsquo;s business hours with a different application (e.g., a web server).</p>

<p>With cloud computing, multiple users can access a single server to retrieve and update their data <strong>without purchasing licenses for different applications</strong>.</p>

<h4>Scalability</h4>

<ol>
<li><p>If an application requires only <strong>a small amount of some resource</strong>, say computation, then the service only allocates a small amount, say a small share on a single physical CPU.</p></li>
<li><p>If the application requires <strong>a large amount of some resource</strong>, then the service allocates that large amount, say a grid of CPUs.</p></li>
</ol>


<p>All the complex handling and coordination is performed <strong>by the service, not the application</strong>. In this way the application can scale well.</p>

<p><a href="http://stackoverflow.com/a/1068133">For example</a> a web site written &ldquo;on the cloud&rdquo; may share a server with many other web sites while it has a low amount of traffic. If it ever has massive amounts of traffic, it may be moved to its own dedicated server, or <strong>grid of servers</strong>. This is all handled <strong>by the cloud service (provider)</strong>, so the application shouldn&rsquo;t have to be modified drastically to cope.</p>

<h4>Other Advantages</h4>

<p>Using Cloud Computing, companies can <a href="http://www.ibeehosting.com/blog/what-is-the-difference-between-cloud-computing-and-grid-computing.html">scale upto High capacities</a> immediately without investing in new infrastructure, training the people or new software licensing. It is more useful for small and medium scale businesses who wants to outsource their Data Center infrastructure, or some larger companies also prefer if they want to cut down the costs of building data-centers internally in order to get peak load capacity. In short, consumers use what they need and pay accordingly.</p>

<h3>Grid Computing VS. Cloud Computing</h3>

<ol>
<li><p>Grid Computing is the parent of Cloud computing, cloud actually evolves from Grid Computing.</p></li>
<li><p>A cloud would usually use a grid. A grid is not necessarily a cloud.</p></li>
<li><p>Resource distribution: Cloud computing is a centralized model whereas grid computing is a decentralized model where the computation could occur over many administrative domains.</p></li>
<li><p>Ownership: A grid is a collection of computers which is owned by multiple parties in multiple locations and connected together so that users can share the combined power of resources. Whereas a cloud is a collection of computers usually owned by a single party.</p></li>
</ol>


<h4>Examples</h4>

<p>Examples of Clouds: Amazon Web Services (AWS), Google App Engine, Dropbox, Gmail, Facebook, Youtube, Rapidshare</p>

<p>Examples of Grids: FutureGrid</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/06/big-data-storage/">[Design] Big Data Storage</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-06T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2015/01/06/big-data-storage/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2015/01/06/big-data-storage/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.mitbbs.com/article/JobHunting/32580869_0.html">ref</a></p>

<h3>Question</h3>

<p><strong>Given 1 trillion messages</strong> on fb and each message has at max 10 words.</p>

<p>How do you build the <strong>index table</strong> and how many machines do you need on the <strong>cluster</strong> to store the index table?</p>

<h3>One possible answer</h3>

<p>Total data = 1 trillion * 10 words * 6 bytes / word = 60TB = one small NetApp box</p>

<p><strong>Index by hashed userid</strong>; will distribute traffic effectively across servers; cache active users recent messages in memory.</p>

<p><a href="http://www.glassdoor.com/Interview/Given-a-set-of-n-jobs-with-start-time-end-time-cost-find-a-subset-so-that-no-2-jobs-overlap-and-the-cost-is-maximum-QTN_440168.htm">Cannot use Netapp box</a>. From what I read in FB engg blog, they have all the info in main memory of server.</p>

<p>Total data = 1 trillion * 10 words * 6 bytes / word = 60TB + 1TB for Indexes.</p>

<p>Considering servers have 64 GB ram. 61 GB usable to store index, 1000 servers.</p>

<h4>For more information</h4>

<p>Read 2 other posts: <strong>[Design] Distributed hash table</strong> and <strong>[Design] Cloud, Grid and Cluster</strong>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class="well">
  <h1>Categories</h1>
  <ul id="categories" class="nav nav-list">
    <li class='category'><a href='/blog/categories/cc150v4/'>cc150v4 (34)</a></li>
<li class='category'><a href='/blog/categories/cc150v5/'>cc150v5 (28)</a></li>
<li class='category'><a href='/blog/categories/design/'>design (51)</a></li>
<li class='category'><a href='/blog/categories/epic/'>epic (1)</a></li>
<li class='category'><a href='/blog/categories/experience/'>experience (3)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (9)</a></li>
<li class='category'><a href='/blog/categories/fundamental/'>fundamental (5)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (37)</a></li>
<li class='category'><a href='/blog/categories/java-oop/'>java oop (19)</a></li>
<li class='category'><a href='/blog/categories/leetcode/'>leetcode (153)</a></li>
<li class='category'><a href='/blog/categories/leetcode-plus/'>leetcode_plus (9)</a></li>
<li class='category'><a href='/blog/categories/lintcode/'>lintcode (11)</a></li>
<li class='category'><a href='/blog/categories/ninechap/'>ninechap (15)</a></li>
<li class='category'><a href='/blog/categories/question/'>question (85)</a></li>
<li class='category'><a href='/blog/categories/string-search/'>string search (5)</a></li>
<li class='category'><a href='/blog/categories/testing/'>testing (7)</a></li>
<li class='category'><a href='/blog/categories/top-k/'>top k (5)</a></li>
<li class='category'><a href='/blog/categories/twitter/'>twitter (3)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/09/most-frequent-word-from-book/">[Question] Most Frequent Word From a Book</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/09/match-triplet-with-reverse-order/">[Question] Match Triplet With Reverse Order</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/09/longest-common-substring/">[Question] Longest Common Contiguous Intersection (Longest Common Substring)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/08/number-of-distinct-substrings/">[Google] Number of Distinct Substrings</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/08/all-number-given-decimal-scale/">[Google] Check All Numbers Given the Decimal Scale</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Charlie Brown -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'woodstockblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
