<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[My Octopress Blog]]></title>
  <link href="http://okckd.github.io/atom.xml" rel="self"/>
  <link href="http://okckd.github.io/"/>
  <updated>2014-08-29T00:08:15+08:00</updated>
  <id>http://okckd.github.io/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Google] Google Pre-interview Coaching]]></title>
    <link href="http://okckd.github.io/blog/2014/08/28/google-pre-interview-coaching/"/>
    <updated>2014-08-28T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/28/google-pre-interview-coaching</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Write a program that breaks up a string of words with no spaces into a string with the appropriate spaces.</p></blockquote>

<p>Follow the following process:</p>

<ol>
<li>Clarify the problem</li>
<li>Refine the solution</li>
<li>Code it</li>
<li>Last words</li>
</ol>


<h3>Clarify the problem</h3>

<ol>
<li>Consider a general case, like &ldquo;fastman&rdquo;</li>
<li>Disambiguate expected result</li>
<li>State the key assumptions</li>
<li>clarify function signature</li>
</ol>


<p>2 words? null input? where is the words from? We might use a dictionary.</p>

<h3>Refine the solution</h3>

<ol>
<li>what if the dictionary cannot fit in RAM</li>
<li>how would you print the most likely of multiple choices</li>
<li>what if the words are not spelled correctly?</li>
<li>Testing</li>
</ol>


<h3>Code it</h3>

<h3>Last words</h3>

<p>Talk naive solution, then come up with a reasonably better one.</p>

<p>Time/Space tradeoff. (like pre-processing or something)</p>

<p>For very big/small input.</p>

<p>White-board practise is important!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v4] 10.7 Ugly Numbers (Hamming Numbers)]]></title>
    <link href="http://okckd.github.io/blog/2014/08/28/Ugly-numbers/"/>
    <updated>2014-08-28T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/28/Ugly-numbers</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Design an algorithm to find the kth number such that the only prime factors are 3, 5, and 7.</p></blockquote>

<h3>Solution</h3>

<p><strong>This is very difficult question</strong>. All I can say is, just memorize this solution.</p>

<p>It works like this:</p>

<ol>
<li>Init 3 queues, with initial value of 3, 5 and 7 respectively.</li>
<li>Fetch the smallest element x at the head of 3 queues.</li>
<li>Add number x to the result list, then:

<ol>
<li>if number x comes from queue3, add 3x, 5x and 7x into 3 queues</li>
<li>if number x comes from queue5, add 5x and 7x into queue5 and queue7</li>
<li>if number x comes from queue7, add 7x into queue7</li>
</ol>
</li>
<li>Fetch next smallest element and do this recursively.</li>
</ol>


<p>A <a href="http://www.geeksforgeeks.org/ugly-numbers/">dp solution</a> is available. It&rsquo;s using the same method actually, but less intuitive.</p>

<h3>Code</h3>

<p>not written</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Thoughts] My World]]></title>
    <link href="http://okckd.github.io/blog/2014/08/28/My-world/"/>
    <updated>2014-08-28T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/28/My-world</id>
    <content type="html"><![CDATA[<pre><code>Please tell me what is taking place,
Cause I can't seem to find a trace,
Guess it must've got erased somehow,
Probably cause I always forget,
Everytime someone tells me their name,
It's always gotta be the same.
(In my World)
Never wore cover-up,
Always beat the boys up,
Grew up in a 5000 population town,
Made my money by cutting grass,
Got fired by fried chicken ass,
All in a small town, Napanee.

You know I always stay up without sleepin',
And think to myself,
Where do I belong forever,
In whose arms, the time and place?

[Chorus:]
Can't help if I space in a daze,
My eyes tune out the other way,
I may switch off and go in a daydream,
In this head my thoughts are deep,
But sometimes I can't even speak,
Would someone be and not pretend? 
I'm off again in my World

I never spend less than an hour,
Washin' my hair in the shower,
It always takes 5 hours to make it straight,
So I'll braid it in a zillion braids,
Though it may take all friggen day,
There's nothin' else better to do anyway.

When you're all alone in the lands of forever,
Lay under the milky way,
On and on it's getting too late out,
I'm not in love this time this night.

[Chorus:] x1

Take some time,
Mellow out,
Party up,
But don't fall down,
Don't get caught,
Sneak out of the house.

[Chorus:] x2
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Design] HTTP Cookie]]></title>
    <link href="http://okckd.github.io/blog/2014/08/28/Http-cookie/"/>
    <updated>2014-08-28T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/28/Http-cookie</id>
    <content type="html"><![CDATA[<h3>First Word</h3>

<p>A cookie is <strong>a small text file</strong> that is stored by a browser on the user’s machine. Cookies are plain text; they contain no executable code.</p>

<p>Every time the user loads the website, the <strong>browser sends the cookie back to the server</strong> to notify the website of the user&rsquo;s previous activity.</p>

<ol>
<li><p>Stateful information</p>

<p> Such as shopping cart</p></li>
<li><p>browsing activity</p>

<p> Such as log in, which button is clicked, and which page is visited</p></li>
</ol>


<h3>Security</h3>

<p>A secure cookie will only be sent to the server when a request is made using SSL and the HTTPS protocol. However, the entire mechanism is inherently insecure.</p>

<p>The cookie just contains data and <strong>isn’t harmful</strong> in and of itself. However, tracking cookies and especially third-party tracking cookies are commonly used as ways to compile long-term records of individuals&#8217; browsing history, which is a potential privacy concern.</p>

<h3>Types of HTTP Cookie</h3>

<p>Common cookie types:</p>

<h4>Session cookie</h4>

<p>It&rsquo;s <strong>while browsing</strong>. (Normally) deleted by browser when the user closes the browser.</p>

<h4>Persistent cookie</h4>

<p>Max-age 1 year. The value set in that cookie would be sent back to the server every time the user visited the server. Also called <strong>tracking cookies</strong></p>

<h4>Secure cookie</h4>

<p>The secure attribute is enabled, and is only used via HTTPS.</p>

<h4>Third-party cookie</h4>

<p><strong>First-party cookies</strong> are cookies that belong to the same domain that is shown in the browser&rsquo;s address bar. <strong>Third-party cookies</strong> are cookies that belong to domains different from the one shown in the address bar.</p>

<p>It opens up the potential for <strong>tracking the user&rsquo;s browsing history</strong>. An example of 3rd-party:</p>

<blockquote><p>As an example, suppose a user visits www.example1.com. This web site contains an advert from ad.foxytracking.com, which, when downloaded, sets a cookie belonging to the advert&rsquo;s domain (ad.foxytracking.com). Then, the user visits another website, www.example2.com, which also contains an advert from ad.foxytracking.com, and which also sets a cookie belonging to that domain (ad.foxytracking.com). Eventually, both of these cookies will be sent to the advertiser when loading their ads or visiting their website. The advertiser can then use these cookies to build up a browsing history of the user across all the websites that have ads from this advertiser.</p></blockquote>

<h4>One more thing</h4>

<p>Nowadays ther&#8217;e a new kind of <strong>HttpOnly cookie</strong> (used only when transmitting HTTP (or HTTPS) requests, thus restricting access from other, non-HTTP APIs such as JavaScript).</p>

<p><a href="http://www.nczonline.net/blog/2009/05/05/http-cookies-explained/">source1</a></p>

<p><a href="http://en.wikipedia.org/wiki/HTTP_cookie">source2</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Twitter] Largest Cycle in Permutation]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/largest-cycle-in-permutation/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/largest-cycle-in-permutation</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://get-that-job-at-google.blogspot.sg/2013/01/twitter-programming-test.html">link</a></p>

<blockquote><p>Given a permutation which contains numbers in the range [1, N], return the length of the largest cycle in the permutation.</p>

<p>A <a href="http://mathworld.wolfram.com/PermutationCycle.html">permutation cycle</a> is a subset of a permutation whose elements trade places with one another.</p>

<p>Sample Testcases:</p>

<p>a) longestCycle([2 3 1]) returns 3, since only cycle is (1 2 3) whose length is 3</p>

<p>b) longestCycle([5 4 3 2 1]) returns 2, since the permutation can be decomposed into (1 5), (2 4), (3)</p></blockquote>

<h3>Solution</h3>

<p>This is just an idea.</p>

<p>Now first of all, its important to understand <strong>what is a cycle in permutation</strong>.</p>

<p>Keeping that in mind, I take (5,4,3,2,1) as an example. First, we fetch 5, and we swap number 5 with the 5th element of the array (which is 1). After this swap, value 1 is in the 1st position, so this cycle is done, the length is 2.</p>

<p>We continue doing this until <strong>all numbers of value v is in the (v)th position</strong>, we should know the largest length of cycle during this process.</p>

<p>I did not write code for this, and there&rsquo;s little resource online that&rsquo;s relevant.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Google] Google API Read4096 (read4K)]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/google-api-read-4096/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/google-api-read-4096</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://www.careercup.com/question?id=14424684">link</a></p>

<blockquote><p>Given API: int Read4096(char* buf);</p>

<p>It reads data from a file and records the position so that the next time when it is called it read the next 4k chars (or the rest of the file, whichever is smaller) from the file. The return is the number of chars read.</p>

<p>Use above API to Implement API &ldquo;int Read(char* buf, int n)&rdquo; which reads any number of chars from the file.</p></blockquote>

<h3>Solution</h3>

<p>Since the nature of C++ and Java is different, I changed the api to:</p>

<pre><code>GoogleApi.read4096(){}
GoogleRead4096.read(int n){}
</code></pre>

<p>As <a href="http://www.careercup.com/question?id=14424684">suggested</a>, the solution is to keep <strong>one local buffer</strong>, and 1 pointer within the buffer.</p>

<h3>Code</h3>

<pre><code>String buffer = null;
int p = 0;

public String read(int n) {
    if (n &lt; 0) {
        return null;
    } else if (n == 0) {
        return "";
    }
    StringBuilder sb = new StringBuilder();
    while (n &gt; 0) {
        // there is (LENGTH - p) chars left in the local buffer
        if (buffer == null || p == buffer.length()) {
            // no char left in buffer, update buffer
            buffer = GoogleApi.read4096();
            p = 0;
            if (buffer.length() == 0) {
                // finish reading the file (no more input chars)
                break;
            }
        } else {
            int numChars = buffer.length() - p;
            if (numChars &gt;= n) {
                sb.append(buffer.substring(p, p + n));
                p = p + n;
                n = 0;
            } else {
                sb.append(buffer.substring(p));
                p = buffer.length();
                n -= numChars;
            }
        }
    }
    return sb.toString();
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Question] Equilibrium Points in 2D Array]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/equilibrium-points-in-2d-array/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/equilibrium-points-in-2d-array</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://get-that-job-at-google.blogspot.sg/2013/01/twitter-programming-test.html">link</a></p>

<blockquote><p>In a 2D matrix of dimensions M*N, find number of &ldquo;equilibrium&rdquo; points.  A point (i, j) is said to be an &ldquo;equilibrium&rdquo; point only if all following conditions hold:</p>

<p>a) sum of rows 1&hellip;(i-1) =  sum of rows (i+1)&hellip;M</p>

<p>b) sum of columns 1&hellip;(j-1)  = sum of columns (j+1)&hellip;N</p></blockquote>

<h3>Solution</h3>

<p>This is <strong>a generalize question of </strong>Equilibrium index__. For now, I got no better idea then checking Equilibrium index for every single node in the matrix.</p>

<p>So this question literally becomes <a href="http://www.geeksforgeeks.org/equilibrium-index-of-an-array/">this</a>:</p>

<blockquote><p>Equilibrium index of an array is an index such that the sum of elements at lower indexes is equal to the sum of elements at higher indexes. For example, in an arrya A:</p>

<p>A[0] = -7, A[1] = 1, A[2] = 5, A[3] = 2, A[4] = -4, A[5] = 3, A[6]=0</p>

<p>3 is an equilibrium index, because:
A[0] + A[1] + A[2] = A[4] + A[5] + A[6]</p>

<p>6 is also an equilibrium index, because sum of zero elements is zero, i.e., A[0] + A[1] + A[2] + A[3] + A[4] + A[5]=0</p></blockquote>

<p><strong>The idea</strong> is to get total sum of array first. Then Iterate through the array and keep updating the left sum.</p>

<h3>Code</h3>

<p><strong>code for <a href="http://rosettacode.org/wiki/Equilibrium_index#Java">findning EI in 1-D array</a></strong></p>

<pre><code>public List&lt;Integer&gt; findEI(int[] array) {
    List&lt;Integer&gt; ans = new ArrayList&lt;Integer&gt;();
    int sum = 0;
    for (int i = 0; i &lt; array.length; i++) {
        sum += array[i];
    }
    int runningSum = 0;
    for (int i = 0; i &lt; array.length; i++) {
        if (2 * runningSum + array[i] == sum) {
            ans.add(i);
        }
        runningSum += array[i];
    }
    return ans;
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Question] Find Word That Has the Most Letters Given]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/Word-that-has-most-letters-given/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/Word-that-has-most-letters-given</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://programmers.stackexchange.com/questions/188687/try-to-find-a-word-in-the-dictionary-that-has-most-letters-given">link</a></p>

<blockquote><p>Given some random letters, for example &ldquo;a,e,o,g,z,k,l,j,w,n&rdquo; and a dictionary.</p>

<p>Try to find a word in the dictionary that has most letters given.</p>

<p>Example: &ldquo;abbee&rdquo; &ndash;> 3 occurance.</p></blockquote>

<h3>Solution</h3>

<ol>
<li><p>Make an array that marks all given chars. Like this:</p>

<p> index={a:1, b:0, c:0, d:0, e:1, f:0, g:1&hellip;}</p></li>
<li><p>Iterate over each word of dictionary.</p>

<p> The array gives an easy way to search a char&rsquo;s existance. I did not write code for this question.</p></li>
</ol>


<h3>Code</h3>

<pre><code>max=0;
max_index=0;

foreach(dictionary as position=&gt;word) {
    sum=0;
    foreach(word as letter)
    {
      sum += index[letter];
    }
    if(sum &gt; max)
    {
        max = sum;
        max_index = position;
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Question] Duplicate Rows in Matrix]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/Duplicate-rows-in-matrix/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/Duplicate-rows-in-matrix</id>
    <content type="html"><![CDATA[<h3>Question 1</h3>

<p><a href="http://www.careercup.com/question?id=6488077455327232">link</a></p>

<blockquote><p>Given a 2D array (n x m) of integers, find all duplicate rows and print their index.</p></blockquote>

<h3>Solution</h3>

<p>This is a <a href="http://get-that-job-at-google.blogspot.sg/2012/12/google-interview-experience.html">google question</a>.</p>

<p><strong>Use HashMap</strong> (but make your own). Computer hash value of each row and insert into HashMap as value pair of HashMap(hashValue, rowNumber). When there&rsquo;s a collision, just check the rowNumber stored in HashMap with current row.</p>

<p>This requires O(n*m) time and O(n) space. Note that <strong>we&rsquo;re not store the entire row into HashMap</strong> cuz it&rsquo;ll take up too much space.</p>

<p>We (probably) can also use Trie.</p>

<h3>Question 2</h3>

<p><a href="http://www.careercup.com/question?id=9478119">link</a></p>

<blockquote><p>Given a binary matrix of N X N of integers, you need to return only unique rows of binary arrays.</p></blockquote>

<pre><code>input: 
0 1 0 0 1 
1 0 1 1 0 
0 1 0 0 1 
1 1 1 0 0 

ans: 
0 1 0 0 1 
1 0 1 1 0 
1 1 1 0 0
</code></pre>

<h3>Solution</h3>

<p>Different from <strong>Question 1</strong>, this input is only 0 and 1.</p>

<p><strong>The solution is to use Trie</strong>. Each node <a href="http://www.geeksforgeeks.org/print-unique-rows/">only have 2 children</a> (that&rsquo;s why Trie is perfect solution here).</p>

<h3>Code</h3>

<p><strong>Using binary trie node</strong>, refactored by me.</p>

<pre><code>public int[][] getUniqueRows(int[][] matrix) {
    int m = matrix.length;
    int n = matrix[0].length;

    TrieNode root = new TrieNode();
    TrieNode p;
    int uniqueCount = 0;
    boolean[] isUnique = new boolean[m];
    // isUnique is used to mark the lines that would appear in final result

    // start to build the trie
    for (int i = 0; i &lt; m; i++) {
        // insert number matrix[i][] into the trie
        p = root;
        // root element would be an empty heading for all numbers
        for (int j = 0; j &lt; n; j++) {
            int digit = matrix[i][j];
            if (p.kids == null) {
                p.kids = new TrieNode[2];
            }
            if (p.kids[digit] == null) {
                // this is a whole new branch, create a new node here
                p.kids[digit] = new TrieNode();
                if (j == n - 1) {
                    uniqueCount++;
                    isUnique[i] = true;
                }
            }
            p = p.kids[digit];
        }
    }
    System.out.println("uniqueCount is " + uniqueCount);
    int[][] result = new int[uniqueCount][];
    int k = 0;
    for (int w = 0; w &lt; isUnique.length; w++) {
        if (isUnique[w]) {
            result[k++] = matrix[w];
        }
    }
    return result;
}

class TrieNode {
    TrieNode[] kids = null;
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Twitter] Count Visible Nodes in Binary Tree]]></title>
    <link href="http://okckd.github.io/blog/2014/08/27/Count-visible-nodes-binary-tree/"/>
    <updated>2014-08-27T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/27/Count-visible-nodes-binary-tree</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://codesays.com/2014/solution-to-count-visible-nodes-in-binary-tree/">link</a></p>

<blockquote><p> In a binary tree, if in the path from root to the node A, there is no node with greater value than A’s, this node A is visible. We need to count the number of visible nodes in a binary tree. For example, in the following tree:</p></blockquote>

<pre><code>        5
     /     \
   3        10
  / \      /
20   21   1
</code></pre>

<blockquote><p>There are four (4) visible nodes: 5, 20, 21, and 10.</p></blockquote>

<h3>Solution</h3>

<p>This is an easy question. A solution is available <a href="http://codesays.com/2014/solution-to-count-visible-nodes-in-binary-tree/">here</a>.</p>

<h3>Code</h3>

<p><strong>written by me</strong></p>

<pre><code>public int countVisible(TreeNode root) {
    return helper(root, Integer.MIN_VALUE);
}

private int helper(TreeNode node, int ancesterMax) {
    if (node == null) {
        return 0;
    }
    int newMax = Math.max(ancesterMax, node.val);
    if (node.val &gt; ancesterMax) {
        return 1 + helper(node.left, newMax) + helper(node.right, newMax);
    } else {
        return helper(node.left, newMax) + helper(node.right, newMax);
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Design] Virtual Memory, Page Fault and Thrashing]]></title>
    <link href="http://okckd.github.io/blog/2014/08/26/Virtual-memory-page-fault-thrashing/"/>
    <updated>2014-08-26T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/26/Virtual-memory-page-fault-thrashing</id>
    <content type="html"><![CDATA[<h3>Terminologies</h3>

<h4>Paging</h4>

<p><a href="http://whatis.techtarget.com/definition/paging">Paging</a> is a method of writing data to, and reading it from, <strong>secondary storage</strong> for use in <strong>primary storage</strong>, also known as main memory. Paging plays a role in memory management for a operating system.</p>

<h4>Page table</h4>

<p><a href="http://en.wikipedia.org/wiki/Page_table">A page table</a> is the data structure used by a virtual memory system to store the mapping between <strong>virtual addresses</strong> and <strong>physical addresses</strong>.</p>

<h4>Page fault</h4>

<p>Page fault is an <strong>interrupt</strong> that occurs when a program requests data that is <strong>not currently in real memory</strong>. The interrupt triggers the operating system to fetch the data from a virtual memory and load it into RAM.</p>

<p>An <strong>invalid page fault</strong> or <strong>page fault error</strong> occurs when the operating system cannot find the data in virtual memory. This usually happens when the virtual memory area, or the table that maps virtual addresses to real addresses, becomes corrupt.</p>

<h4>Logical address</h4>

<p><a href="http://en.wikipedia.org/wiki/Logical_address">Logical address</a> is the address at which an item (memory cell, storage element, network host) appears to reside from the perspective of an executing application program.</p>

<h4>Physical address</h4>

<p><a href="http://en.wikipedia.org/wiki/Physical_address">Physical address</a> (also real address, or binary address), is a memory address that is represented in the form of a binary number for accessing main memory.</p>

<p><a href="http://www.geekinterview.com/question_details/3186">In general</a>, Logical address is the address generated <strong>by the CPU</strong>. Where as physical address is the <strong>actual address of the process in the memory</strong>. The CPU generates the logical address that is added with the <strong>offset value</strong> to get the actual address of the process inthe memory.</p>

<h4>Thrashing</h4>

<p><a href="http://www.computerhope.com/jargon/t/thrash.htm">Thrashing</a> or disk thrashing is a term used to describe when the hard drive is <strong>being overworked by moving information</strong> between the system memory and virtual memory excessively.</p>

<h3>Demand Paging</h3>

<p>Virtual memory is implemented (mostly) using demand paging. <strong><a href="http://www.webopedia.com/TERM/D/demand_paging.html">Demand Paging</a></strong> is a type of swapping in which pages of data are not copied from disk to RAM until they are needed. This is an example of a <a href="http://en.wikipedia.org/wiki/Demand_paging">lazy loading technique</a>.</p>

<p>Pros:</p>

<ol>
<li>less RAM needed</li>
<li>more users</li>
<li>less I/O</li>
</ol>


<p>When a pages is needed, if <strong>invalid referernce</strong>, abort the process. else <strong>if valid</strong>, it&rsquo;s called page fault.</p>

<p>Page fault time:</p>

<ol>
<li>servicing the page fault interrupt</li>
<li>read in new page (major part)</li>
<li>restart the process</li>
</ol>


<h3>Page Replacement</h3>

<ol>
<li>FIFO</li>
<li>Optimal Algorithm</li>
<li>LRU</li>
<li>LRU Approximation

<ol>
<li>Additional-Reference-Bits algorithm</li>
<li>Second-Chance (Clock) algorithm</li>
</ol>
</li>
</ol>


<p>Refer to another post <strong>&ldquo;Cache and Page Replacement Algorithms&rdquo;</strong>.</p>

<h3>Solution to Thrashing</h3>

<ol>
<li>More RAM</li>
<li>Less program running together</li>
<li>Assign working priorities</li>
<li>Improve <a href="http://en.wikipedia.org/wiki/Thrashing_(computer_science">spatial locality</a>#Solutions) by replacing loops, i.e.</li>
</ol>


<p>Replace</p>

<pre><code>// recall that in C, arrays use Row-major order
int m[256][256]; 
for (k=0; k&lt;256; k++) { 
    for (i=0; i&lt;256; i++) { 
        m[i][k] = something(); 
    }
}
</code></pre>

<p>with</p>

<pre><code>int m[256][256]; 
for (i=0; i&lt;256; i++) { 
    for (k=0; k&lt;256; k++) {
        // consecutive values of k reside in adjacent memory locations 
        m[i][k] = something(); 
    }
}
</code></pre>

<p>So that the use of data elements is within relatively <a href="http://en.wikipedia.org/wiki/Locality_of_reference">close storage locations</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Testing] Test hashCode() Function]]></title>
    <link href="http://okckd.github.io/blog/2014/08/26/Test-hashcode-function/"/>
    <updated>2014-08-26T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/26/Test-hashcode-function</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>How to test hashCode() function? Example:</p></blockquote>

<pre><code>public int hashCode(){
    int result = 17 + hashDouble(re);
    result = 31 * result + hashDouble(im);
    return result;
}
</code></pre>

<h3>Solution</h3>

<p>We need to test that the hash function is <a href="http://stackoverflow.com/a/4449791">reflexive, symmetric, and transitive</a>.</p>

<h3>Code</h3>

<p>Not including &lsquo;not equal&rsquo; test.</p>

<pre><code>@Test
public void testEquals_Symmetric() {
    Person x = new Person("Foo Bar");  // equals and hashCode check name field value
    Person y = new Person("Foo Bar");
    Assert.assertTrue(x.equals(y) &amp;&amp; y.equals(x));
    Assert.assertTrue(x.hashCode() == y.hashCode());
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Thoughts] Ten Years Is a Long Time]]></title>
    <link href="http://okckd.github.io/blog/2014/08/26/Ten-years-is-a-long-time/"/>
    <updated>2014-08-26T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/26/Ten-years-is-a-long-time</id>
    <content type="html"><![CDATA[<h3>Life isn&rsquo;t always going along nicely.</h3>

<p>Remember this.</p>

<p>Keep Holding On</p>

<pre><code>You're not alone, together we stand
I'll be by your side you know I'll take your hand
When it gets cold, and it feels like the end
There's no place to go you know I won't give in
(Ah, Ah) No I won't give in (Ah, Ah-Ah)

Keep holding on
'Cause you know we'll make it through
We'll make it through

Just stay strong
'Cause you know I'm here for you
I'm here for you

There's nothing you can say (Nothing you can say)
Nothing you could do (Nothing you could do)
There's no other way when it comes to the truth so

Keep holding on
'Cause you know we'll make it through
We'll make it through

So far away, I wish you were here
Before it's too late this could all disappear
Before the doors close, and it comes to an end
With you by my side I will fight and defend
(Ah, Ah) I'll fight and defend (Ah, Ah-Ah) Yeah, Yeah

Keep holding on (x1)

Hear me when I say when I say "I believe"
Nothing's gonna change nothing's gonna change destiny
Whatever's meant to be will work out perfectly
Yea-Eh, Yea-Eh, Yea-Eh, Yea-Eh-Ah-Ah (Ah-Ah, Ah-Ah)
La-Da-Da-Da, La-Da-Da-Da, La-Da-Da-Da-Da-Da-Da-Da-Da

Keep holding on(x2)
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Design] OOD Design of Elevator]]></title>
    <link href="http://okckd.github.io/blog/2014/08/26/Design-OOD-elevator/"/>
    <updated>2014-08-26T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/26/Design-OOD-elevator</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<p><a href="http://thought-works.blogspot.sg/2012/11/object-oriented-design-for-elevator-in.html">link</a></p>

<blockquote><p>Object Oriented design for Elevator in a multi-storied apartment</p></blockquote>

<h3>A Single Elevator</h3>

<p>Use Case:</p>

<ol>
<li>User

<ol>
<li>press a button to summon the lift</li>
<li>press a button to get to a specific floor</li>
</ol>
</li>
<li>Button

<ol>
<li>floor button and level button</li>
<li>illuminates when pressed</li>
<li>place an &lsquo;elevator request&rsquo; when pressed</li>
</ol>
</li>
<li>Elevator

<ol>
<li>moves up/down</li>
<li>open/close the door</li>
</ol>
</li>
</ol>


<p><img class="middle" src="http://okckd.github.io/assets/images/elevator-class-diagram.png"></p>

<p><strong>ElevatorRequests Class</strong></p>

<p>Each button press results in an elevator request which has to be served. Each of these requests is tracked at a global place. ElevatorRequests, the class which stores elevator requests can use different strategies to schedule the elevator requests.</p>

<p><strong>ElevatorController</strong></p>

<p>The elevator is controlled by a controller class which we call ElevatorController. The elevator controller instructs the elevator what to do and also can shutdown/start up the elevator of the building. The elevator controller reads the next elevator request to be processed and serves it.</p>

<p><strong>Button (Abstract) Class</strong></p>

<p>Button is abstract class defining common behavior like illuminate, doNotIlluminate. FloorButton, ElevatorButton extend Button type and define placeRequest() which is invoked when the button is pressed.</p>

<p>In conclusion, <strong>ElevatorController</strong> runs the show by reading the <strong>ElevatorRequests</strong> to process and instructing the <strong>Elevator</strong> what to do. User send request by pressing <strong>Buttons</strong>.</p>

<h3>Extend the answer to multiple elevators</h3>

<ol>
<li><p>Each elevator have 1 controller.</p></li>
<li><p>Floor based requests can be served by any elevator, thus these requests are added to a common area accessible by all controllers.</p></li>
<li><p>Each elevator controller runs as a separate thread and checks if it can process a floor request. Mind synchronization issues.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.4 Design a Parking Lot]]></title>
    <link href="http://okckd.github.io/blog/2014/08/25/design-parking-lot/"/>
    <updated>2014-08-25T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/25/design-parking-lot</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Design a Parking Lot.</p></blockquote>

<h3>Solution</h3>

<p>Class hierarchy:</p>

<ol>
<li>A parking lot has multiple Levels.</li>
<li>A Level has multiple Parking Spot.</li>
<li>A Spot can park motorcycle, car or bus, which all belongs to Vehicle.</li>
</ol>


<p>Implement methods:</p>

<ol>
<li>Vehicle.parkInSpot(Spot s)</li>
<li>Vehicle.leaveSpot(Spot s)</li>
<li>Vehicle.canFitIn(Spot s)</li>
<li>ParkingLot.parkVehicle(Vehicle v)</li>
<li>Level.parkVehicle(Vehicle v)</li>
<li>Level.parkVehicleAtSpot(Vehicle v, Spot s)</li>
<li>Level.findAvailableSpot(VehicleType vt)</li>
</ol>


<p><strong>ParkingLot Class is just a wrapper class of Levels</strong>. By doing this, we seperated out parking logic from other broader actions (like Spot management).</p>

<p>The code below is from CC150v5. <strong>Its design is a bit strange</strong> (a car can occupy multiple spots), so just use this code as a guide but not a reference.</p>

<h3>Code</h3>

<p>ParkingLot.java</p>

<pre><code>public class ParkingLot {
    private Level[] levels;
    private final int NUM_LEVELS = 5;

    public ParkingLot() {
        levels = new Level[NUM_LEVELS];
        for (int i = 0; i &lt; NUM_LEVELS; i++) {
            levels[i] = new Level(i, 30);
        }
    }

    /* Park the vehicle in a spot (or multiple spots). Return false if failed. */
    public boolean parkVehicle(Vehicle vehicle) {
        for (int i = 0; i &lt; levels.length; i++) {
            if (levels[i].parkVehicle(vehicle)) {
                return true;
            }
        }
        return false;
    }

    public void print() {
        for (int i = 0; i &lt; levels.length; i++) {
            System.out.print("Level" + i + ": ");
            levels[i].print();
            System.out.println("");
        }
        System.out.println("");
    }
}
</code></pre>

<p>Level.java</p>

<pre><code>/* Represents a level in a parking garage */
public class Level {
    private int floor;
    private ParkingSpot[] spots;
    private int availableSpots = 0; // number of free spots
    private static final int SPOTS_PER_ROW = 10;

    public Level(int flr, int numberSpots) {
        floor = flr;
        spots = new ParkingSpot[numberSpots];
        int largeSpots = numberSpots / 4;
        int bikeSpots = numberSpots / 4;
        int compactSpots = numberSpots - largeSpots - bikeSpots;
        for (int i = 0; i &lt; numberSpots; i++) {
            VehicleSize sz = VehicleSize.Motorcycle;
            if (i &lt; largeSpots) {
                sz = VehicleSize.Large;
            } else if (i &lt; largeSpots + compactSpots) {
                sz = VehicleSize.Compact;
            }
            int row = i / SPOTS_PER_ROW;
            spots[i] = new ParkingSpot(this, row, i, sz);
        }
        availableSpots = numberSpots;
    }

    public int availableSpots() {
        return availableSpots;
    }

    /* Try to find a place to park this vehicle. Return false if failed. */
    public boolean parkVehicle(Vehicle vehicle) {
        if (availableSpots() &lt; vehicle.getSpotsNeeded()) {
            return false;
        }
        int spotNumber = findAvailableSpots(vehicle);
        if (spotNumber &lt; 0) {
            return false;
        }
        return parkStartingAtSpot(spotNumber, vehicle);
    }

    /* Park a vehicle starting at the spot spotNumber, and continuing until vehicle.spotsNeeded. */
    private boolean parkStartingAtSpot(int spotNumber, Vehicle vehicle) {
        vehicle.clearSpots();
        boolean success = true;
        for (int i = spotNumber; i &lt; spotNumber + vehicle.spotsNeeded; i++) {
             success &amp;= spots[i].park(vehicle);
        }
        availableSpots -= vehicle.spotsNeeded;
        return success;
    }

    /* find a spot to park this vehicle. Return index of spot, or -1 on failure. */
    private int findAvailableSpots(Vehicle vehicle) {
        int spotsNeeded = vehicle.getSpotsNeeded();
        int lastRow = -1;
        int spotsFound = 0;
        for (int i = 0; i &lt; spots.length; i++) {
            ParkingSpot spot = spots[i];
            if (lastRow != spot.getRow()) {
                spotsFound = 0;
                lastRow = spot.getRow();
            }
            if (spot.canFitVehicle(vehicle)) {
                spotsFound++;
            } else {
                spotsFound = 0;
            }
            if (spotsFound == spotsNeeded) {
                return i - (spotsNeeded - 1);
            }
        }
        return -1;
    }

    public void print() {
        int lastRow = -1;
        for (int i = 0; i &lt; spots.length; i++) {
            ParkingSpot spot = spots[i];
            if (spot.getRow() != lastRow) {
                System.out.print("  ");
                lastRow = spot.getRow();
            }
            spot.print();
        }
    }

    /* When a car was removed from the spot, increment availableSpots */
    public void spotFreed() {
        availableSpots++;
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.9 Design a In-memory File System]]></title>
    <link href="http://okckd.github.io/blog/2014/08/25/design-in-memory-file-system/"/>
    <updated>2014-08-25T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/25/design-in-memory-file-system</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Explain the data structures and algorithms that you would use to design an in-memory file system. Illustrate with an example in code where possible.</p></blockquote>

<h3>Solution</h3>

<p><strong>A file system consists of Files and Directories</strong>. Each Directory contains a set of Files and Directories.</p>

<p>Since Files and Directories share so many characteristics, we&rsquo;ve implemented them such that they <strong>inherit from the same class</strong> &mdash; Entry.</p>

<h3>Code</h3>

<p>Entry.java</p>

<pre><code>public abstract class Entry {
    protected Directory parent;
    protected long created;
    protected long lastUpdated;
    protected long lastAccessed;
    protected String name;

    public Entry(String n, Directory p) {
        name = n;
        parent = p;
        created = System.currentTimeMillis();
    }

    public boolean delete() {
        if (parent == null) {
            return false;
        }
        return parent.deleteEntry(this);
    }

    public abstract int size();

    public String getFullPath() {
        if (parent == null) {
            return name;
        } else {
            return parent.getFullPath() + "/" + name;
        }
    }

    public long getCreationTime() {
        return created;
    }

    public long getLastUpdatedTime() {
        return lastUpdated;
    }

    public long getLastAccessedTime() {
        return lastAccessed;
    }

    public void changeName(String n) {
        name = n;
    }

    public String getName() {
        return name;
    }
}
</code></pre>

<p>Directory.java</p>

<pre><code>public class Directory extends Entry {
    protected ArrayList&lt;Entry&gt; contents;

    public Directory(String n, Directory p) {
        super(n, p);
        contents = new ArrayList&lt;Entry&gt;();
    }

    protected ArrayList&lt;Entry&gt; getContents() {
        return contents;
    }

    public int size() {
        int size = 0;
        for (Entry e : contents) {
            size += e.size();
        }
        return size;
    }

    public int numberOfFiles() {
        int count = 0;
        for (Entry e : contents) {
            if (e instanceof Directory) {
                count++; // Directory counts as a file
                Directory d = (Directory) e;
                count += d.numberOfFiles();
            } else if (e instanceof File) {
                count++;
            }
        }
        return count;
    }

    public boolean deleteEntry(Entry entry) {
        return contents.remove(entry);
    }

    public void addEntry(Entry entry) {
        contents.add(entry);
    }
}
</code></pre>

<p>File.java</p>

<pre><code>public class File extends Entry {
    private String content;
    private int size;

    public File(String n, Directory p, int sz) {
        super(n, p);
        size = sz;
    }

    public int size() {
        return size;
    }

    public String getContents() {
        return content;
    }

    public void setContents(String c) {
        content = c;
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.10 Implement a Hashmap]]></title>
    <link href="http://okckd.github.io/blog/2014/08/25/Implement-HashMap/"/>
    <updated>2014-08-25T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/25/Implement-HashMap</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Design and implement a hash table which uses chaining (linked lists) to handle collisions.</p></blockquote>

<h3>Solution</h3>

<p>I wrote this topic before (using Java source code as a reference). This time, I would like to take another (easier) approach.</p>

<p>The main part of this is to use an array of list structure like this:</p>

<pre><code>LinkedList&lt;Cell&lt;K, V&gt;&gt;[] items;
</code></pre>

<p>And the Cell Class looks like this:</p>

<pre><code>public class Cell&lt;K, V&gt; {
    private K key;
    private V value;

    public Cell(K k, V v) {
        key = k;
        value = v;
    }

    public boolean equivalent(Cell&lt;K, V&gt; c) {
        return equivalent(c.getKey());
    }

    public boolean equivalent(K k) {
        return key.equals(k);
    }

    public K getKey() {
        return key;
    }

    public V getValue() {
        return value;
    }
}
</code></pre>

<h3>Code</h3>

<p><strong>written by me</strong></p>

<pre><code>public class HashMapCC150&lt;K, V&gt; {

    int size;
    LinkedList&lt;Cell&lt;K, V&gt;&gt;[] items;

    public HashMapCC150(int num) {
        this.size = num;
        items = (LinkedList&lt;Cell&lt;K, V&gt;&gt;[]) new LinkedList[10];
    }

    public V get(K k) {
        int hashValue = this.calculateHashCode(k);
        if (items[hashValue] == null) {
            items[hashValue] = new LinkedList&lt;Cell&lt;K, V&gt;&gt;();
            return null;
        }
        for (Cell&lt;K, V&gt; cell : items[hashValue]) {
            if (k.equals(cell.getKey())) {
                return cell.getValue();
            }
        }
        return null;
    }

    public V put(K k, V v) {
        int hashValue = this.calculateHashCode(k);
        if (items[hashValue] == null) {
            items[hashValue] = new LinkedList&lt;Cell&lt;K, V&gt;&gt;();
        }
        for (Cell&lt;K, V&gt; cell : items[hashValue]) {
            if (k.equals(cell.getKey())) {
                items[hashValue].remove(cell);
                break;
            }
        }
        Cell&lt;K, V&gt; newItem = new Cell&lt;K, V&gt;(k, v);
        items[hashValue].add(newItem);
        return null;
    }

    public V remove(K k) {
        // not written
        return null;
    }

    private int calculateHashCode(K k) {
        return k.toString().length() % size;
    }

    public static void main(String[] args) {
        HashMapCC150&lt;String, String&gt; map = new HashMapCC150&lt;String, String&gt;(10);
        map.put("kevin", "durant");
        map.put("steven", "curry");
        map.put("al", "jefferson");
        System.out.println(map.get("kevin"));
        System.out.println(map.get("steven"));
        System.out.println(map.get("al"));
        map.put("kevin", "martin");
        map.put("steven", "nash");
        map.put("kevin", "braynt");
        System.out.println(map.get("kevin"));
        System.out.println(map.get("steven"));
        System.out.println(map.get("al"));
    }
}

class Cell&lt;K, V&gt; {
    private K key;
    private V value;

    public Cell(K k, V v) {
        key = k;
        value = v;
    }

    public boolean equivalent(Cell&lt;K, V&gt; c) {
        return equivalent(c.getKey());
    }

    public boolean equivalent(K k) {
        return key.equals(k);
    }

    public K getKey() {
        return key;
    }

    public V getValue() {
        return value;
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.8 Design Othello Game]]></title>
    <link href="http://okckd.github.io/blog/2014/08/24/design-othello-game/"/>
    <updated>2014-08-24T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/24/design-othello-game</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Othello is played as follows: Each Othello piece is white on one side and black on the other. When a piece is surrounded by its opponents on both the left and right sides, or both the top and bottom, it is said to be captured and its color is flipped.</p>

<p>The win is assigned to the person with the most pieces. Implement the object-oriented design for Othello.</p></blockquote>

<h3>Class</h3>

<ol>
<li>Game

<ol>
<li>Two Player objects</li>
<li>a board object</li>
<li>singleton class (unless otherwise specified, this needs to be discussed)</li>
</ol>
</li>
<li>Board

<ol>
<li>Keep the score (black/white count). Of course we can put score in Game Class as well, it seems logically related to the board a bit more.</li>
<li>Array of Piece objects</li>
<li>getScore() method</li>
</ol>
</li>
<li>Piece

<ol>
<li>stores color info</li>
<li>flip() function</li>
</ol>
</li>
<li>Player

<ol>
<li>stores color info</li>
<li>playPiece() method</li>
</ol>
</li>
<li>Color Enum</li>
<li>Direction Enum</li>
</ol>


<h3>Functions</h3>

<ol>
<li>placePiece() by the Player (which triggers the following 2 methods)</li>
<li>private flipSection(Position fromWhere, Color c, Direction up/down/left/right) by the board</li>
<li>private updateScore() by the board</li>
<li>getScore() by the board</li>
</ol>


<h4>Follow up: Do we need separate Board and Game classes?</h4>

<p>Strictly speaking, no. The drawback is adding an extra layers. A function that calls Game class is immediately calling Board class.</p>

<p>But keeping the objects separate allows us to have a logical separation between the board (which contains just logic involving placing pieces) and the game (which involves times, game flow, etc.).</p>

<h3>Conclusion</h3>

<p>This is an easy, and very standard OOD question. Keep the logic clear, design the layers and object hierarchy, and the rest of things will come naturally.</p>

<h3>Code</h3>

<p>Game.java</p>

<pre><code>public class Game {
    private Player[] players;
    private static Game instance;
    private Board board;
    private final int ROWS = 10;
    private final int COLUMNS = 10;

    private Game() {
        board = new Board(ROWS, COLUMNS);
        players = new Player[2];
        players[0] = new Player(Color.Black);
        players[1] = new Player(Color.White);
        Automator.getInstance().initialize(players); // used for testing
    }

    public static Game getInstance() {
        if (instance == null) {
            instance = new Game();
        }
        return instance;
    }

    public Board getBoard() {
        return board;
    }
}
</code></pre>

<p>Board.java</p>

<pre><code>public class Board {
    private int blackCount = 0;
    private int whiteCount = 0;
    private Piece[][] board;

    public Board(int rows, int columns) {
        board = new Piece[rows][columns];
    }

    public void initialize() {
        /* initial board has a grid like the following in the center:
         *     WB
         *     BW
         */
        int middleRow = board.length / 2;
        int middleColumn = board[middleRow].length / 2;
        board[middleRow][middleColumn] = new Piece(Color.White);
        board[middleRow + 1][middleColumn] = new Piece(Color.Black);
        board[middleRow + 1][middleColumn + 1] = new Piece(Color.White);
        board[middleRow][middleColumn + 1] = new Piece(Color.Black);
        blackCount = 2;
        whiteCount = 2;
    }

    public boolean placeColor(int row, int column, Color color) {
        if (board[row][column] != null) {
            return false;
        }

        /* attempt to flip each of the four directions */
        int[] results = new int[4];
        results[0] = flipSection(row - 1, column, color, Direction.up);
        results[1] = flipSection(row + 1, column, color, Direction.down);
        results[2] = flipSection(row, column + 1, color, Direction.right);
        results[3] = flipSection(row, column - 1, color, Direction.left);

        /* compute how many pieces were flipped */
        int flipped = 0;
        for (int result : results) {
            if (result &gt; 0) {
                flipped += result;
            }
        }

        /* if nothing was flipped, then it's an invalid move */
        if (flipped &lt; 0) {
            return false;
        }

        /* flip the piece, and update the score */
        board[row][column] = new Piece(color);
        updateScore(color, flipped + 1);
        return true;
    }

    private int flipSection(int row, int column, Color color, Direction d) {
        /* Compute the delta for the row and the column. At all times, only the row or the column
         * will have a delta, since we're only moving in one direction at a time.
         */
        int r = 0;
        int c = 0;
        switch (d) {
        case up:
            r = -1;
            break;
        case down:
            r = 1;
            break;
        case left:
            c = -1;
            break;
        case right:
            c = 1;
            break;
        }

        /* If out of bounds, or nothing to flip, return an error (-1) */
        if (row &lt; 0 || row &gt;= board.length || column &lt; 0 || column &gt;= board[row].length || board[row][column] == null) {
            return -1;
        }

        /* Found same color - return nothing flipped */
        if (board[row][column].getColor() == color) {
            return 0;
        }

        /* Recursively flip the remainder of the row. If -1 is returned, then we know we hit the boundary
         * of the row (or a null piece) before we found our own color, so there's nothing to flip. Return
         * the error code.
         */
        int flipped = flipSection(row + r, column + c, color, d);
        if (flipped &lt; 0) {
            return -1;
        }

        /* flip our own color */
        board[row][column].flip();
        return flipped + 1;
    }

    public int getScoreForColor(Color c) {
        if (c == Color.Black) {
            return blackCount;
        } else {
            return whiteCount;
        }
    }

    private void updateScore(Color newColor, int newPieces) {
        /* If we added x pieces of a color, then we actually removed x - 1 pieces of the other
         * color. The -1 is because one of the new pieces was the just-placed one.
         */
        if (newColor == Color.Black) {
            whiteCount -= newPieces - 1;
            blackCount += newPieces;
        } else {
            blackCount -= newPieces - 1;            
            whiteCount += newPieces;
        }
    }

    public void printBoard() {
        for (int r = 0; r &lt; board.length; r++) {
            for (int c = 0; c &lt; board[r].length; c++) {
                if (board[r][c] == null) {
                    System.out.print("_");
                } else if (board[r][c].getColor() == Color.White) {
                    System.out.print("W");
                } else {
                    System.out.print("B");
                }
            }
            System.out.println();
        }
    }
}
</code></pre>

<p>Player.java</p>

<pre><code>public class Player {
    private Color color;
    public Player(Color c) {
        color = c;
    }

    public int getScore() {
        return Game.getInstance().getBoard().getScoreForColor(color);
    }

    public boolean playPiece(int row, int column) {
        return Game.getInstance().getBoard().placeColor(row, column, color);
    }

    public Color getColor() {
        return color;
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.7 Design Online Chat Server (2)]]></title>
    <link href="http://okckd.github.io/blog/2014/08/24/design-online-chat-server-2/"/>
    <updated>2014-08-24T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/24/design-online-chat-server-2</id>
    <content type="html"><![CDATA[<p>&hellip; Continued from previous post.</p>

<h3>Overall view</h3>

<p>The system consists of a database, a set of clients, and a set of servers. This is not about OOD, but we need to know.</p>

<ol>
<li><p>DB stores user list, chat archive. An SQL DB would be good, <strong>unless we want BigTable for scalability purpose</strong>.</p></li>
<li><p><strong>We use XML for server-client communication</strong>. Because it&rsquo;s debugging friendly.</p></li>
<li><p><strong>A set of servers</strong>.</p>

<ol>
<li>Data will be <strong>divided up across machines</strong>, requiring us to potentially hop from machine to machine.</li>
<li>When possible, we will try to <strong>replicate some data</strong> across machines to minimize the lookups.</li>
<li>One major design constraint here is to <strong>prevent having a single point of failure</strong>. For instance, if one machine controlled all the user sign-ins, then we&rsquo;d cut off millions of users potentially if a single machine lost network connectivity.</li>
</ol>
</li>
</ol>


<h3>Hardest problems</h3>

<p>Or the most interesting questions.</p>

<h4>Q1: How do we know if someone is online?</h4>

<p>While we would like users to tell us when they sign off, we can&rsquo;t know for sure. A user&rsquo;s connection might have died, for example. To make sure that we know when a user has signed off, we might try regularly pinging the client to make sure it&rsquo;s still there.</p>

<h4>Q2: How do we deal with conflicting information?</h4>

<p>We have some information stored in the computer&rsquo;s memory and some in the database. What happens if they get out of sync? Which one is &ldquo;right&rdquo;?</p>

<h4>Q3: How do we make our server scale?</h4>

<p>While we designed out chat server without worrying—too much- about scalability, in real life this would be a concern. We&rsquo;d need to split our data across many servers, which would increase our concern about out-of-sync data.</p>

<h4>Q4: How we do prevent denial of service attacks?</h4>

<p>Clients can push data to us —- what if they try to DOS (denial of service) us? How do we prevent that?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[CC150v5] 8.7 Design Online Chat Server (1)]]></title>
    <link href="http://okckd.github.io/blog/2014/08/24/design-online-chat-server-1/"/>
    <updated>2014-08-24T00:00:00+08:00</updated>
    <id>http://okckd.github.io/blog/2014/08/24/design-online-chat-server-1</id>
    <content type="html"><![CDATA[<h3>Question</h3>

<blockquote><p>Explain how you would design a chat server. In particular, provide details about the various back end components, classes, and methods.</p>

<p>What would be the hardest problems to solve?</p></blockquote>

<h3>Solution</h3>

<p>First, decide the objects and methods. Here we&rsquo;ll focus on the core user management and conversation aspects.</p>

<h4>Class</h4>

<ol>
<li>UserMgmt (business logic)</li>
<li>User (includes basic info, UserStatus, a map of conversation, a map of requests)</li>
<li>UserStatus (on/offline, status message)</li>
<li>Conversation Abstract Class (a list of user and a list of messages)

<ol>
<li>PrivateChat (private conversation)</li>
<li>GroupChat</li>
</ol>
</li>
<li>Message (a string and a date/time)</li>
<li>Request (add request and delete request, involves 2 Users)</li>
</ol>


<h4>Functions</h4>

<ol>
<li>Sign in and log off (update availability)</li>
<li>update status message</li>
<li>add/delete request</li>
<li>send/accept/reject a request</li>
<li>create a conversation (group or private)</li>
<li>add a new message (group or private)</li>
</ol>


<h3>Code</h3>

<p>The most important classes is User and UserMgmt. The others are simply data containers.</p>

<p>UserManager.java</p>

<pre><code>public class UserManager {
    private static UserManager instance;
    private HashMap&lt;Integer, User&gt; usersById = new HashMap&lt;Integer, User&gt;();
    private HashMap&lt;String, User&gt; usersByAccountName = new HashMap&lt;String, User&gt;();
    private HashMap&lt;Integer, User&gt; onlineUsers = new HashMap&lt;Integer, User&gt;();

    public static UserManager getInstance() {
        if (instance == null) {
            instance = new UserManager();
        }
        return instance;
    }

    public void addUser(User fromUser, String toAccountName) {
        User toUser = usersByAccountName.get(toAccountName);
        AddRequest req = new AddRequest(fromUser, toUser, new Date());
        toUser.receivedAddRequest(req);
        fromUser.sentAddRequest(req);
    }

    public void approveAddRequest(AddRequest req) {
        req.status = RequestStatus.Accepted;
        User from = req.getFromUser();
        User to = req.getToUser();
        from.addContact(to);
        to.addContact(from);
    }

    public void rejectAddRequest(AddRequest req) {
        req.status = RequestStatus.Rejected;
        User from = req.getFromUser();
        User to = req.getToUser();
        from.removeAddRequest(req);
        to.removeAddRequest(req);       
    }

    public void userSignedOn(String accountName) {
        User user = usersByAccountName.get(accountName);
        if (user != null) {
            user.setStatus(new UserStatus(UserStatusType.Available, ""));           
            onlineUsers.put(user.getId(), user);
        }
    }

    public void userSignedOff(String accountName) {
        User user = usersByAccountName.get(accountName);
        if (user != null) {
            user.setStatus(new UserStatus(UserStatusType.Offline, ""));
            onlineUsers.remove(user.getId());
        }
    }   
}
</code></pre>

<p>User.java</p>

<p>Property:</p>

<ol>
<li>id and name</li>
<li>a map of conversations</li>
<li>a map of sent request</li>
<li>a map of received request</li>
<li>a map of friends list</li>
</ol>


<p>Methods:</p>

<ol>
<li>sendMessageToUser(User)</li>
<li>addContact(User)</li>
<li>receivedAddRequest(Request)</li>
<li>sentAddRequest(Request)</li>
<li>removeAddRequest(Request)</li>
<li>addConversation(Conversation)</li>
</ol>


<p>Note that all user actions are controlled by the UserManager Class. For example, when adding a friend:</p>

<ol>
<li>User A clicks &ldquo;add user&rdquo; on the client.</li>
<li>User A calls requestAddUser (User B).</li>
<li>This method calls UserManager.addUser(User a, userBid).</li>
<li>UserManager calls both User A.sentAddRequest() and User B.receivedAddRequest().</li>
</ol>


<p>Code:</p>

<pre><code>public class User {
    private int id;
    private UserStatus status = null;
    private HashMap&lt;Integer, PrivateChat&gt; privateChats = new HashMap&lt;Integer, PrivateChat&gt;();
    private ArrayList&lt;GroupChat&gt; groupChats = new ArrayList&lt;GroupChat&gt;();
    private HashMap&lt;Integer, AddRequest&gt; receivedAddRequests = new HashMap&lt;Integer, AddRequest&gt;();
    private HashMap&lt;Integer, AddRequest&gt; sentAddRequests = new HashMap&lt;Integer, AddRequest&gt;();

    private HashMap&lt;Integer, User&gt; contacts = new HashMap&lt;Integer, User&gt;();
    private String accountName;
    private String fullName;

    public User(int id, String accountName, String fullName) {
        this.accountName = accountName;
        this.fullName = fullName;
        this.id = id;
    }

    public boolean sendMessageToUser(User toUser, String content) {
        PrivateChat chat = privateChats.get(toUser.getId());
        if (chat == null) {
            chat = new PrivateChat(this, toUser);
            privateChats.put(toUser.getId(), chat);
        }
        Message message = new Message(content, new Date());
        return chat.addMessage(message);
    }

    public boolean sendMessageToGroupChat(int groupId, String content) {
        GroupChat chat = groupChats.get(groupId);
        if (chat != null) {
            Message message = new Message(content, new Date());
            return chat.addMessage(message);
        }
        return false;
    }

    public void setStatus(UserStatus status) {
        this.status = status;
    }

    public UserStatus getStatus() {
        return status;
    }

    public boolean addContact(User user) {
        if (contacts.containsKey(user.getId())) {
            return false;
        } else {
            contacts.put(user.getId(), user);
            return true;
        }
    }

    public void receivedAddRequest(AddRequest req) {
        int senderId = req.getFromUser().getId();
        if (!receivedAddRequests.containsKey(senderId)) {
            receivedAddRequests.put(senderId, req);
        }       
    }

    public void sentAddRequest(AddRequest req) {
        int receiverId = req.getFromUser().getId();
        if (!sentAddRequests.containsKey(receiverId)) {
            sentAddRequests.put(receiverId, req);
        }       
    }

    public void removeAddRequest(AddRequest req) {
        if (req.getToUser() == this) {
            receivedAddRequests.remove(req);
        } else if (req.getFromUser() == this) {
            sentAddRequests.remove(req);
        }
    }

    public void requestAddUser(String accountName) {
        UserManager.getInstance().addUser(this, accountName);
    }

    public void addConversation(PrivateChat conversation) {
        User otherUser = conversation.getOtherParticipant(this);
        privateChats.put(otherUser.getId(), conversation);
    }

    public void addConversation(GroupChat conversation) {
        groupChats.add(conversation);
    }   

    public int getId() {
        return id;
    }

    public String getAccountName() {
        return accountName;
    }

    public String getFullName() {
        return fullName;
    }
}
</code></pre>
]]></content>
  </entry>
  
</feed>
