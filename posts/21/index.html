
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Woodstock Blog</title>
  <meta name="author" content="Charlie Brown">

  
  <meta name="description" content="Question Explain the data structures and algorithms that you would use to design an in-memory file system. Illustrate with an example in code where &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://okckd.github.io/posts/21">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Woodstock Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52495723-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Woodstock Blog</a></h1>
  
    <h2>What's the good of living if you don't try a few things?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:okckd.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/25/design-in-memory-file-system/">[CC150v5] 8.9 Design a In-memory File System</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-25T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/25/design-in-memory-file-system/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/25/design-in-memory-file-system/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<blockquote><p>Explain the data structures and algorithms that you would use to design an in-memory file system. Illustrate with an example in code where possible.</p></blockquote>

<h3>Solution</h3>

<p><strong>A file system consists of Files and Directories</strong>. Each Directory contains a set of Files and Directories.</p>

<p>Since Files and Directories share so many characteristics, we&rsquo;ve implemented them such that they <strong>inherit from the same class</strong> &mdash; Entry.</p>

<h3>Code</h3>

<p>Entry.java</p>

<pre><code>public abstract class Entry {
    protected Directory parent;
    protected long created;
    protected long lastUpdated;
    protected long lastAccessed;
    protected String name;

    public Entry(String n, Directory p) {
        name = n;
        parent = p;
        created = System.currentTimeMillis();
    }

    public boolean delete() {
        if (parent == null) {
            return false;
        }
        return parent.deleteEntry(this);
    }

    public abstract int size();

    public String getFullPath() {
        if (parent == null) {
            return name;
        } else {
            return parent.getFullPath() + "/" + name;
        }
    }

    public long getCreationTime() {
        return created;
    }

    public long getLastUpdatedTime() {
        return lastUpdated;
    }

    public long getLastAccessedTime() {
        return lastAccessed;
    }

    public void changeName(String n) {
        name = n;
    }

    public String getName() {
        return name;
    }
}
</code></pre>

<p>Directory.java</p>

<pre><code>public class Directory extends Entry {
    protected ArrayList&lt;Entry&gt; contents;

    public Directory(String n, Directory p) {
        super(n, p);
        contents = new ArrayList&lt;Entry&gt;();
    }

    protected ArrayList&lt;Entry&gt; getContents() {
        return contents;
    }

    public int size() {
        int size = 0;
        for (Entry e : contents) {
            size += e.size();
        }
        return size;
    }

    public int numberOfFiles() {
        int count = 0;
        for (Entry e : contents) {
            if (e instanceof Directory) {
                count++; // Directory counts as a file
                Directory d = (Directory) e;
                count += d.numberOfFiles();
            } else if (e instanceof File) {
                count++;
            }
        }
        return count;
    }

    public boolean deleteEntry(Entry entry) {
        return contents.remove(entry);
    }

    public void addEntry(Entry entry) {
        contents.add(entry);
    }
}
</code></pre>

<p>File.java</p>

<pre><code>public class File extends Entry {
    private String content;
    private int size;

    public File(String n, Directory p, int sz) {
        super(n, p);
        size = sz;
    }

    public int size() {
        return size;
    }

    public String getContents() {
        return content;
    }

    public void setContents(String c) {
        content = c;
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/25/Implement-HashMap/">[CC150v5] 8.10 Implement a Hashmap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-25T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/25/Implement-HashMap/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/25/Implement-HashMap/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<blockquote><p>Design and implement a hash table which uses chaining (linked lists) to handle collisions.</p></blockquote>

<h3>Solution</h3>

<p>I wrote this topic before (using Java source code as a reference). This time, I would like to take another (easier) approach.</p>

<p>The main part of this is to use an array of list structure like this:</p>

<pre><code>LinkedList&lt;Cell&lt;K, V&gt;&gt;[] items;
</code></pre>

<p>And the Cell Class looks like this:</p>

<pre><code>public class Cell&lt;K, V&gt; {
    private K key;
    private V value;

    public Cell(K k, V v) {
        key = k;
        value = v;
    }

    public boolean equivalent(Cell&lt;K, V&gt; c) {
        return equivalent(c.getKey());
    }

    public boolean equivalent(K k) {
        return key.equals(k);
    }

    public K getKey() {
        return key;
    }

    public V getValue() {
        return value;
    }
}
</code></pre>

<h3>Code</h3>

<p><strong>written by me</strong></p>

<pre><code>public class HashMapCC150&lt;K, V&gt; {

    int size;
    LinkedList&lt;Cell&lt;K, V&gt;&gt;[] items;

    public HashMapCC150(int num) {
        this.size = num;
        items = (LinkedList&lt;Cell&lt;K, V&gt;&gt;[]) new LinkedList[10];
    }

    public V get(K k) {
        int hashValue = this.calculateHashCode(k);
        if (items[hashValue] == null) {
            items[hashValue] = new LinkedList&lt;Cell&lt;K, V&gt;&gt;();
            return null;
        }
        for (Cell&lt;K, V&gt; cell : items[hashValue]) {
            if (k.equals(cell.getKey())) {
                return cell.getValue();
            }
        }
        return null;
    }

    public V put(K k, V v) {
        int hashValue = this.calculateHashCode(k);
        if (items[hashValue] == null) {
            items[hashValue] = new LinkedList&lt;Cell&lt;K, V&gt;&gt;();
        }
        for (Cell&lt;K, V&gt; cell : items[hashValue]) {
            if (k.equals(cell.getKey())) {
                items[hashValue].remove(cell);
                break;
            }
        }
        Cell&lt;K, V&gt; newItem = new Cell&lt;K, V&gt;(k, v);
        items[hashValue].add(newItem);
        return null;
    }

    public V remove(K k) {
        // not written
        return null;
    }

    private int calculateHashCode(K k) {
        return k.toString().length() % size;
    }

    public static void main(String[] args) {
        HashMapCC150&lt;String, String&gt; map = new HashMapCC150&lt;String, String&gt;(10);
        map.put("kevin", "durant");
        map.put("steven", "curry");
        map.put("al", "jefferson");
        System.out.println(map.get("kevin"));
        System.out.println(map.get("steven"));
        System.out.println(map.get("al"));
        map.put("kevin", "martin");
        map.put("steven", "nash");
        map.put("kevin", "braynt");
        System.out.println(map.get("kevin"));
        System.out.println(map.get("steven"));
        System.out.println(map.get("al"));
    }
}

class Cell&lt;K, V&gt; {
    private K key;
    private V value;

    public Cell(K k, V v) {
        key = k;
        value = v;
    }

    public boolean equivalent(Cell&lt;K, V&gt; c) {
        return equivalent(c.getKey());
    }

    public boolean equivalent(K k) {
        return key.equals(k);
    }

    public K getKey() {
        return key;
    }

    public V getValue() {
        return value;
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/24/design-othello-game/">[CC150v5] 8.8 Design Othello Game</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-24T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/24/design-othello-game/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/24/design-othello-game/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<blockquote><p>Othello is played as follows: Each Othello piece is white on one side and black on the other. When a piece is surrounded by its opponents on both the left and right sides, or both the top and bottom, it is said to be captured and its color is flipped.</p>

<p>The win is assigned to the person with the most pieces. Implement the object-oriented design for Othello.</p></blockquote>

<h3>Class</h3>

<ol>
<li>Game

<ol>
<li>Two Player objects</li>
<li>a board object</li>
<li>singleton class (unless otherwise specified, this needs to be discussed)</li>
</ol>
</li>
<li>Board

<ol>
<li>Keep the score (black/white count). Of course we can put score in Game Class as well, it seems logically related to the board a bit more.</li>
<li>Array of Piece objects</li>
<li>getScore() method</li>
</ol>
</li>
<li>Piece

<ol>
<li>stores color info</li>
<li>flip() function</li>
</ol>
</li>
<li>Player

<ol>
<li>stores color info</li>
<li>playPiece() method</li>
</ol>
</li>
<li>Color Enum</li>
<li>Direction Enum</li>
</ol>


<h3>Functions</h3>

<ol>
<li>placePiece() by the Player (which triggers the following 2 methods)</li>
<li>private flipSection(Position fromWhere, Color c, Direction up/down/left/right) by the board</li>
<li>private updateScore() by the board</li>
<li>getScore() by the board</li>
</ol>


<h4>Follow up: Do we need separate Board and Game classes?</h4>

<p>Strictly speaking, no. The drawback is adding an extra layers. A function that calls Game class is immediately calling Board class.</p>

<p>But keeping the objects separate allows us to have a logical separation between the board (which contains just logic involving placing pieces) and the game (which involves times, game flow, etc.).</p>

<h3>Conclusion</h3>

<p>This is an easy, and very standard OOD question. Keep the logic clear, design the layers and object hierarchy, and the rest of things will come naturally.</p>

<h3>Code</h3>

<p>Game.java</p>

<pre><code>public class Game {
    private Player[] players;
    private static Game instance;
    private Board board;
    private final int ROWS = 10;
    private final int COLUMNS = 10;

    private Game() {
        board = new Board(ROWS, COLUMNS);
        players = new Player[2];
        players[0] = new Player(Color.Black);
        players[1] = new Player(Color.White);
        Automator.getInstance().initialize(players); // used for testing
    }

    public static Game getInstance() {
        if (instance == null) {
            instance = new Game();
        }
        return instance;
    }

    public Board getBoard() {
        return board;
    }
}
</code></pre>

<p>Board.java</p>

<pre><code>public class Board {
    private int blackCount = 0;
    private int whiteCount = 0;
    private Piece[][] board;

    public Board(int rows, int columns) {
        board = new Piece[rows][columns];
    }

    public void initialize() {
        /* initial board has a grid like the following in the center:
         *     WB
         *     BW
         */
        int middleRow = board.length / 2;
        int middleColumn = board[middleRow].length / 2;
        board[middleRow][middleColumn] = new Piece(Color.White);
        board[middleRow + 1][middleColumn] = new Piece(Color.Black);
        board[middleRow + 1][middleColumn + 1] = new Piece(Color.White);
        board[middleRow][middleColumn + 1] = new Piece(Color.Black);
        blackCount = 2;
        whiteCount = 2;
    }

    public boolean placeColor(int row, int column, Color color) {
        if (board[row][column] != null) {
            return false;
        }

        /* attempt to flip each of the four directions */
        int[] results = new int[4];
        results[0] = flipSection(row - 1, column, color, Direction.up);
        results[1] = flipSection(row + 1, column, color, Direction.down);
        results[2] = flipSection(row, column + 1, color, Direction.right);
        results[3] = flipSection(row, column - 1, color, Direction.left);

        /* compute how many pieces were flipped */
        int flipped = 0;
        for (int result : results) {
            if (result &gt; 0) {
                flipped += result;
            }
        }

        /* if nothing was flipped, then it's an invalid move */
        if (flipped &lt; 0) {
            return false;
        }

        /* flip the piece, and update the score */
        board[row][column] = new Piece(color);
        updateScore(color, flipped + 1);
        return true;
    }

    private int flipSection(int row, int column, Color color, Direction d) {
        /* Compute the delta for the row and the column. At all times, only the row or the column
         * will have a delta, since we're only moving in one direction at a time.
         */
        int r = 0;
        int c = 0;
        switch (d) {
        case up:
            r = -1;
            break;
        case down:
            r = 1;
            break;
        case left:
            c = -1;
            break;
        case right:
            c = 1;
            break;
        }

        /* If out of bounds, or nothing to flip, return an error (-1) */
        if (row &lt; 0 || row &gt;= board.length || column &lt; 0 || column &gt;= board[row].length || board[row][column] == null) {
            return -1;
        }

        /* Found same color - return nothing flipped */
        if (board[row][column].getColor() == color) {
            return 0;
        }

        /* Recursively flip the remainder of the row. If -1 is returned, then we know we hit the boundary
         * of the row (or a null piece) before we found our own color, so there's nothing to flip. Return
         * the error code.
         */
        int flipped = flipSection(row + r, column + c, color, d);
        if (flipped &lt; 0) {
            return -1;
        }

        /* flip our own color */
        board[row][column].flip();
        return flipped + 1;
    }

    public int getScoreForColor(Color c) {
        if (c == Color.Black) {
            return blackCount;
        } else {
            return whiteCount;
        }
    }

    private void updateScore(Color newColor, int newPieces) {
        /* If we added x pieces of a color, then we actually removed x - 1 pieces of the other
         * color. The -1 is because one of the new pieces was the just-placed one.
         */
        if (newColor == Color.Black) {
            whiteCount -= newPieces - 1;
            blackCount += newPieces;
        } else {
            blackCount -= newPieces - 1;            
            whiteCount += newPieces;
        }
    }

    public void printBoard() {
        for (int r = 0; r &lt; board.length; r++) {
            for (int c = 0; c &lt; board[r].length; c++) {
                if (board[r][c] == null) {
                    System.out.print("_");
                } else if (board[r][c].getColor() == Color.White) {
                    System.out.print("W");
                } else {
                    System.out.print("B");
                }
            }
            System.out.println();
        }
    }
}
</code></pre>

<p>Player.java</p>

<pre><code>public class Player {
    private Color color;
    public Player(Color c) {
        color = c;
    }

    public int getScore() {
        return Game.getInstance().getBoard().getScoreForColor(color);
    }

    public boolean playPiece(int row, int column) {
        return Game.getInstance().getBoard().placeColor(row, column, color);
    }

    public Color getColor() {
        return color;
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/24/design-online-chat-server-2/">[CC150v5] 8.7 Design Online Chat Server (2)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-24T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/24/design-online-chat-server-2/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/24/design-online-chat-server-2/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&hellip; Continued from previous post.</p>

<h3>Overall view</h3>

<p>The system consists of a database, a set of clients, and a set of servers. This is not about OOD, but we need to know.</p>

<ol>
<li><p>DB stores user list, chat archive. An SQL DB would be good, <strong>unless we want BigTable for scalability purpose</strong>.</p></li>
<li><p><strong>We use XML for server-client communication</strong>. Because it&rsquo;s debugging friendly.</p></li>
<li><p><strong>A set of servers</strong>.</p>

<ol>
<li>Data will be <strong>divided up across machines</strong>, requiring us to potentially hop from machine to machine.</li>
<li>When possible, we will try to <strong>replicate some data</strong> across machines to minimize the lookups.</li>
<li>One major design constraint here is to <strong>prevent having a single point of failure</strong>. For instance, if one machine controlled all the user sign-ins, then we&rsquo;d cut off millions of users potentially if a single machine lost network connectivity.</li>
</ol>
</li>
</ol>


<h3>Hardest problems</h3>

<p>Or the most interesting questions.</p>

<h4>Q1: How do we know if someone is online?</h4>

<p>While we would like users to tell us when they sign off, we can&rsquo;t know for sure. A user&rsquo;s connection might have died, for example. To make sure that we know when a user has signed off, we might try regularly pinging the client to make sure it&rsquo;s still there.</p>

<h4>Q2: How do we deal with conflicting information?</h4>

<p>We have some information stored in the computer&rsquo;s memory and some in the database. What happens if they get out of sync? Which one is &ldquo;right&rdquo;?</p>

<h4>Q3: How do we make our server scale?</h4>

<p>While we designed out chat server without worrying—too much- about scalability, in real life this would be a concern. We&rsquo;d need to split our data across many servers, which would increase our concern about out-of-sync data.</p>

<h4>Q4: How we do prevent denial of service attacks?</h4>

<p>Clients can push data to us —- what if they try to DOS (denial of service) us? How do we prevent that?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/24/design-online-chat-server-1/">[CC150v5] 8.7 Design Online Chat Server (1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-24T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/24/design-online-chat-server-1/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/24/design-online-chat-server-1/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<blockquote><p>Explain how you would design a chat server. In particular, provide details about the various back end components, classes, and methods.</p>

<p>What would be the hardest problems to solve?</p></blockquote>

<h3>Solution</h3>

<p>First, decide the objects and methods. Here we&rsquo;ll focus on the core user management and conversation aspects.</p>

<h4>Class</h4>

<ol>
<li>UserMgmt (business logic)</li>
<li>User (includes basic info, UserStatus, a map of conversation, a map of requests)</li>
<li>UserStatus (on/offline, status message)</li>
<li>Conversation Abstract Class (a list of user and a list of messages)

<ol>
<li>PrivateChat (private conversation)</li>
<li>GroupChat</li>
</ol>
</li>
<li>Message (a string and a date/time)</li>
<li>Request (add request and delete request, involves 2 Users)</li>
</ol>


<h4>Functions</h4>

<ol>
<li>Sign in and log off (update availability)</li>
<li>update status message</li>
<li>add/delete request</li>
<li>send/accept/reject a request</li>
<li>create a conversation (group or private)</li>
<li>add a new message (group or private)</li>
</ol>


<h3>Code</h3>

<p>The most important classes is User and UserMgmt. The others are simply data containers.</p>

<p>UserManager.java</p>

<pre><code>public class UserManager {
    private static UserManager instance;
    private HashMap&lt;Integer, User&gt; usersById = new HashMap&lt;Integer, User&gt;();
    private HashMap&lt;String, User&gt; usersByAccountName = new HashMap&lt;String, User&gt;();
    private HashMap&lt;Integer, User&gt; onlineUsers = new HashMap&lt;Integer, User&gt;();

    public static UserManager getInstance() {
        if (instance == null) {
            instance = new UserManager();
        }
        return instance;
    }

    public void addUser(User fromUser, String toAccountName) {
        User toUser = usersByAccountName.get(toAccountName);
        AddRequest req = new AddRequest(fromUser, toUser, new Date());
        toUser.receivedAddRequest(req);
        fromUser.sentAddRequest(req);
    }

    public void approveAddRequest(AddRequest req) {
        req.status = RequestStatus.Accepted;
        User from = req.getFromUser();
        User to = req.getToUser();
        from.addContact(to);
        to.addContact(from);
    }

    public void rejectAddRequest(AddRequest req) {
        req.status = RequestStatus.Rejected;
        User from = req.getFromUser();
        User to = req.getToUser();
        from.removeAddRequest(req);
        to.removeAddRequest(req);       
    }

    public void userSignedOn(String accountName) {
        User user = usersByAccountName.get(accountName);
        if (user != null) {
            user.setStatus(new UserStatus(UserStatusType.Available, ""));           
            onlineUsers.put(user.getId(), user);
        }
    }

    public void userSignedOff(String accountName) {
        User user = usersByAccountName.get(accountName);
        if (user != null) {
            user.setStatus(new UserStatus(UserStatusType.Offline, ""));
            onlineUsers.remove(user.getId());
        }
    }   
}
</code></pre>

<p>User.java</p>

<p>Property:</p>

<ol>
<li>id and name</li>
<li>a map of conversations</li>
<li>a map of sent request</li>
<li>a map of received request</li>
<li>a map of friends list</li>
</ol>


<p>Methods:</p>

<ol>
<li>sendMessageToUser(User)</li>
<li>addContact(User)</li>
<li>receivedAddRequest(Request)</li>
<li>sentAddRequest(Request)</li>
<li>removeAddRequest(Request)</li>
<li>addConversation(Conversation)</li>
</ol>


<p>Note that all user actions are controlled by the UserManager Class. For example, when adding a friend:</p>

<ol>
<li>User A clicks &ldquo;add user&rdquo; on the client.</li>
<li>User A calls requestAddUser (User B).</li>
<li>This method calls UserManager.addUser(User a, userBid).</li>
<li>UserManager calls both User A.sentAddRequest() and User B.receivedAddRequest().</li>
</ol>


<p>Code:</p>

<pre><code>public class User {
    private int id;
    private UserStatus status = null;
    private HashMap&lt;Integer, PrivateChat&gt; privateChats = new HashMap&lt;Integer, PrivateChat&gt;();
    private ArrayList&lt;GroupChat&gt; groupChats = new ArrayList&lt;GroupChat&gt;();
    private HashMap&lt;Integer, AddRequest&gt; receivedAddRequests = new HashMap&lt;Integer, AddRequest&gt;();
    private HashMap&lt;Integer, AddRequest&gt; sentAddRequests = new HashMap&lt;Integer, AddRequest&gt;();

    private HashMap&lt;Integer, User&gt; contacts = new HashMap&lt;Integer, User&gt;();
    private String accountName;
    private String fullName;

    public User(int id, String accountName, String fullName) {
        this.accountName = accountName;
        this.fullName = fullName;
        this.id = id;
    }

    public boolean sendMessageToUser(User toUser, String content) {
        PrivateChat chat = privateChats.get(toUser.getId());
        if (chat == null) {
            chat = new PrivateChat(this, toUser);
            privateChats.put(toUser.getId(), chat);
        }
        Message message = new Message(content, new Date());
        return chat.addMessage(message);
    }

    public boolean sendMessageToGroupChat(int groupId, String content) {
        GroupChat chat = groupChats.get(groupId);
        if (chat != null) {
            Message message = new Message(content, new Date());
            return chat.addMessage(message);
        }
        return false;
    }

    public void setStatus(UserStatus status) {
        this.status = status;
    }

    public UserStatus getStatus() {
        return status;
    }

    public boolean addContact(User user) {
        if (contacts.containsKey(user.getId())) {
            return false;
        } else {
            contacts.put(user.getId(), user);
            return true;
        }
    }

    public void receivedAddRequest(AddRequest req) {
        int senderId = req.getFromUser().getId();
        if (!receivedAddRequests.containsKey(senderId)) {
            receivedAddRequests.put(senderId, req);
        }       
    }

    public void sentAddRequest(AddRequest req) {
        int receiverId = req.getFromUser().getId();
        if (!sentAddRequests.containsKey(receiverId)) {
            sentAddRequests.put(receiverId, req);
        }       
    }

    public void removeAddRequest(AddRequest req) {
        if (req.getToUser() == this) {
            receivedAddRequests.remove(req);
        } else if (req.getFromUser() == this) {
            sentAddRequests.remove(req);
        }
    }

    public void requestAddUser(String accountName) {
        UserManager.getInstance().addUser(this, accountName);
    }

    public void addConversation(PrivateChat conversation) {
        User otherUser = conversation.getOtherParticipant(this);
        privateChats.put(otherUser.getId(), conversation);
    }

    public void addConversation(GroupChat conversation) {
        groupChats.add(conversation);
    }   

    public int getId() {
        return id;
    }

    public String getAccountName() {
        return accountName;
    }

    public String getFullName() {
        return fullName;
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/23/stack-and-heap/">[Design] Stack and Heap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/23/stack-and-heap/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/23/stack-and-heap/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Overview</h3>

<p>Value types are created on the stack, and reference types are created on the heap.</p>

<p><strong>Both are stored in computer RAM</strong>.</p>

<p><strong>Each thread gets a stack</strong>, while there&rsquo;s typically only one heap for the application.</p>

<h4>Stack</h4>

<p><a href="http://stackoverflow.com/a/80113">When a function</a> is called, a block is reserved <strong>on the top of the stack</strong> for local variables and some bookkeeping data in a LIFO order. Freeing a block from the stack is nothing more than adjusting one pointer.</p>

<h4>Heap</h4>

<p>Unlike the stack, there&rsquo;s no enforced pattern to the allocation and deallocation of blocks from the heap; you can allocate a block at any time and free it at any time. This makes it much more complex to keep track of which parts of the heap are allocated or free at any given time; there are many custom heap allocators available to tune heap performance for different usage patterns.</p>

<h3>Q &amp; A</h3>

<h4>What is their scope?</h4>

<p>The stack is attached to a thread, so <strong>when the thread exits</strong> the stack is reclaimed.</p>

<p>The heap is typically allocated at application startup by the runtime, and is reclaimed <strong>when the application (technically process) exits</strong>.</p>

<p>Thread and process &ndash; what&rsquo;s the difference? Read <strong>[Design] Process VS. Thread</strong>.</p>

<h4>What determines the size of each of them?</h4>

<p>The size of the stack is set when a thread is created.</p>

<p>The size of the heap is set on application startup, but can grow as space is needed (the allocator requests more memory from the operating system).</p>

<h4>What makes one faster?</h4>

<p><strong>The stack is faster</strong> because the access pattern makes it trivial to allocate and deallocate memory from it, while the heap has much more complex bookkeeping involved in an allocation or free.</p>

<p>Each byte in the stack tends to be reused very frequently which means it tends to be mapped to the processor&rsquo;s cache, making it very fast.</p>

<p>Another performance hit for the heap is that the heap, being mostly a global resource, typically has to be multi-threading safe, i.e. each allocation and deallocation needs to be (typically) synchronized.</p>

<p><img class="middle" src="/assets/images/stack-and-heap.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/23/Web-hosting-shared-and-vps/">[Design] Shared Hosting vs. VPS Hosting</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/23/Web-hosting-shared-and-vps/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/23/Web-hosting-shared-and-vps/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Shared hosting</h3>

<p><a href="https://kb.greengeeks.com/3072/shared-hosting-vs-vps-hosting/">Shared hosting</a> is like living in an apartment where you share a common space with your neighbors. You cannot customize anything but you share maintenance cost and responsibility with your neighbors.</p>

<ol>
<li>Economical</li>
<li>Technical maintenance of the server is not required</li>
<li>Limited number of resources</li>
<li>Your website performance may be affected by other websites hosted on the shared server</li>
<li>Possible long term problems with scalability and backup</li>
<li>Possible security issues for sharing a common server</li>
</ol>


<h3>Virtual Private Server</h3>

<p>Virtual Private Server (VPS) Hosting is like living in a simplex or half-plex where you can customize everything to your own tastes. However, you still need to maintain your own area. Companies that deal with resource-heavy applications and secured data most often use VPS.</p>

<ol>
<li>Larger space and bandwidth</li>
<li>Can configure anything</li>
<li>Run your own batch files to create multiple services inside the server using shell access</li>
<li>Easy scalability and backup</li>
<li>You need a dedicated system administrator</li>
<li>Costly</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/23/BST-over-hashmap/">[Design] Merits of BST Over HashTables</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-23T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/23/BST-over-hashmap/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/23/BST-over-hashmap/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://stackoverflow.com/questions/4128546/advantages-of-binary-search-trees-over-hash-tables">What are the advantages</a> of binary search trees over hash tables?</p>

<h3>Answer</h3>

<ol>
<li><p><strong>More memory-efficient</strong>. (They do not reserve more memory than they need to)</p>

<p> For instance, if a hash function has a range R(h) = 0&hellip;100, then you need to allocate an array of 100 (pointers-to) elements, even if you are just hashing 20 elements.</p></li>
<li><p><a href="http://stackoverflow.com/a/4128585">Inorder traverse</a>.</p></li>
<li><p>Collision might hamper HashMap&rsquo;s performance.</p></li>
<li><p><a href="http://stackoverflow.com/a/4129272">Resizing issue</a></p>

<p> When the hash table pressure grows too much, you often tend to enlargen and reallocate the hash table. The BST has simpler behavior here and does not tend to suddenly allocate a lot of data and do a rehashing operation.</p></li>
<li><p>Binary search tree do range searches efficiently.</p></li>
</ol>


<h3>One more thing</h3>

<p><strong>Trees tend to be the <a href="http://stackoverflow.com/a/19896875">ultimate average data structure</a></strong>. They can act as lists, can easily be split for parallel operation, have fast removal, insertion and lookup on the order of O(lgn). They do nothing particularly well, but they don&rsquo;t have any excessively bad behavior either.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/22/design-deck-card/">[CC150v5] 8.1 Design a Generic Deck of Cards</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-22T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/22/design-deck-card/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/22/design-deck-card/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<blockquote><p>Design a Generic Deck of Cards</p></blockquote>

<h3>Solution</h3>

<p>A simple design:</p>

<pre><code>enum Suit {
    HEART, DIAMOND, SPADES, CLUBS;
}

class Deck {
    List&lt;Card&gt; deck;
}

class Card {
    Suit suit;
    int num;
}
</code></pre>

<p>A more complex design:</p>

<pre><code>enum Suit {
    HEART, DIAMOND, SPADES, CLUBS;
}

class Deck&lt;T extends Card&gt; {
    List&lt;Card&gt; deck;

    public void shuffle() {
    };
}

abstract class Card {
    boolean available;
    Suit suit;
    int num;

    public boolean isAvailable() {
        return available;
    };
}

class Hand&lt;T extends Card&gt; {
    List&lt;Card&gt; cards;

    public int score() {
        int score = 0;
        for (Card c : cards) {
            score += c.num;
        }
        return score;
    }

    public void addCard(T card) {
        cards.add(card);
    }
}

// Now use the above generic Data Structure to make a
// Blackjack Game
class Blackjack extends Hand&lt;BlackJackCard&gt; {
}

class BlackJackCard extends Card {
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/20/Talk-about-singleton/">[Java OOP] About Singleton</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-20T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/20/Talk-about-singleton/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/20/Talk-about-singleton/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Implement Singlton</h3>

<p><a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html">3 ways</a> of writing Singleton.</p>

<h4>using Enum</h4>

<p>This is only available since Java 6.</p>

<pre><code>public enum Singleton_Enum {
    INSTANCE;
}
</code></pre>

<h4>using double checked locking</h4>

<p>This is <strong>lazy loaded thread-safe</strong> Singleton, which is popular during Java 5 (with the use of Volatile variable).</p>

<pre><code>public class Singleton_DoubleCheckedLocking implements Cloneable {
    private static volatile Singleton_DoubleCheckedLocking INSTANCE;

    private Singleton_DoubleCheckedLocking() {
    }

    public static Singleton_DoubleCheckedLocking getInstance() {
        if (INSTANCE == null) {
            synchronized (Singleton_DoubleCheckedLocking.class) {
                // double checking Singleton instance
                if (INSTANCE == null) {
                    INSTANCE = new Singleton_DoubleCheckedLocking();
                }
            }
        }
        return INSTANCE;
    }
}
</code></pre>

<h4>using static factory method</h4>

<p>Singleton instance is <a href="http://javarevisited.blogspot.sg/2012/07/why-enum-singleton-are-better-in-java.html">static and final variable</a> it initialized when class is first loaded into memeory so creation of instance is inherently <strong>thread-safe</strong>.</p>

<pre><code>public class Singleton_StaticFactory {
    // initailzed during class loading
    private static final Singleton_StaticFactory INSTANCE = new Singleton_StaticFactory();

    // to prevent creating another instance of Singleton
    private Singleton_StaticFactory() {
    }

    public static Singleton_StaticFactory getSingleton() {
        return INSTANCE;
    }
}
</code></pre>

<h3>About thread-safety</h3>

<p><a href="http://javarevisited.blogspot.sg/2012/12/how-to-create-thread-safe-singleton-in-java-example.html">Prior to Java 5</a> <strong>double checked locking</strong> mechanism is used to create thread-safe singleton in Java, which breaks if one Thread doesn&rsquo;t see instance created by other thread at same time and eventually you will end up with more than one instance of Singleton class.</p>

<p>From Java 5 onwards <strong>volatile variable</strong> guarantee can be used to write thread safe singleton by using double checked locking pattern.</p>

<p>I personally don&rsquo;t prefer that way as there are many other simpler alternatives like:</p>

<ol>
<li>using static field</li>
<li>using Enum</li>
</ol>


<h3>Q &amp; A</h3>

<p>Question: How do you prevent for creating another instance of Singleton using clone() method?</p>

<p>Answer: Preferred way is not to implement Clonnable interface. And if you do, just throw Exception from clone() method as &ldquo;Can not create clone of Singleton class&rdquo;.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/22">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/20">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class="well">
  <h1>Categories</h1>
  <ul id="categories" class="nav nav-list">
    <li class='category'><a href='/blog/categories/cc150v4/'>cc150v4 (34)</a></li>
<li class='category'><a href='/blog/categories/cc150v5/'>cc150v5 (28)</a></li>
<li class='category'><a href='/blog/categories/design/'>design (71)</a></li>
<li class='category'><a href='/blog/categories/experience/'>experience (3)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (10)</a></li>
<li class='category'><a href='/blog/categories/fundamental/'>fundamental (11)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (62)</a></li>
<li class='category'><a href='/blog/categories/java-oop/'>java oop (28)</a></li>
<li class='category'><a href='/blog/categories/leetcode/'>leetcode (153)</a></li>
<li class='category'><a href='/blog/categories/leetcode-plus/'>leetcode_plus (9)</a></li>
<li class='category'><a href='/blog/categories/lintcode/'>lintcode (11)</a></li>
<li class='category'><a href='/blog/categories/ninechap/'>ninechap (16)</a></li>
<li class='category'><a href='/blog/categories/question/'>question (116)</a></li>
<li class='category'><a href='/blog/categories/string-search/'>string search (17)</a></li>
<li class='category'><a href='/blog/categories/testing/'>testing (7)</a></li>
<li class='category'><a href='/blog/categories/top-k/'>top k (7)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/12/executives-schedule/">[LinkedIn] Executive&#8217;s Schedule</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/11/speed-up-web-page-4/">[Design] Speed Up Webpage for Slow Connection (4)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/11/speed-up-web-page-3/">[Design] Speed Up Webpage for Slow Connection (3)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/11/speed-up-web-page-2/">[Design] Speed Up Webpage for Slow Connection (2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/11/speed-up-web-page-1/">[Design] Speed Up Webpage for Slow Connection (1)</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Charlie Brown -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'woodstockblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
