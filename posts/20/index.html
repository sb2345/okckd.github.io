
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Woodstock Blog</title>
  <meta name="author" content="Charlie Brown">

  
  <meta name="description" content="Question link 5亿个int找它们的中位数. Analysis Categorized under 双层桶划分. Idea: 首先我们将int划分为216个区域，然后读取数据统计落到各个区域里的数的个数，之后我们根据统计结果就可以判断中位数落到那个区域， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://okckd.github.io/posts/20">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Woodstock Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52495723-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Woodstock Blog</a></h1>
  
    <h2>What's the good of living if you don't try a few things?</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:okckd.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/10/big-data-find-median/">[Design] Big Data - Find Median Numbers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-10T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/10/big-data-find-median/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/10/big-data-find-median/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://blog.csdn.net/v_july_v/article/details/7382693">link</a></p>

<blockquote><p>5亿个int找它们的中位数.</p></blockquote>

<h3>Analysis</h3>

<p>Categorized under <strong>双层桶划分</strong>.</p>

<p>Idea: 首先我们将int划分为2<sup>16</sup>个区域，然后读取数据统计落到各个区域里的数的个数，之后我们根据统计结果就可以判断中位数落到那个区域，同时知道这个区域中的第几大数刚好是中位数。然后第二次扫描我们只统计落在这个区域中的那些数就可以了。</p>

<h3>Details</h3>

<p>开一个大小为65536的Int数组，第一遍读取，统计Int32的高16位的情况(就相当于用该数除以65536)。每读取一个数，数组中对应的计数+1。第一遍统计之后，遍历数组，逐个累加统计，看中位数处于哪个区间。</p>

<p>第二遍统计同上面的方法类似，但这次只统计处于区间k的情况，这次计数之后，再统计一下，看中位数所处的区间，最后将高位和低位组合一下就是结果了。</p>

<p>And this can be done more than 2 times, depending on the input size (eg. if input is int64, then do 24/20/20 bits).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/10/big-data-find-existence-of-number/">[Design] Big Data - Find Existence of a Number</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-10T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/10/big-data-find-existence-of-number/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/10/big-data-find-existence-of-number/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://blog.csdn.net/v_july_v/article/details/7382693">link</a></p>

<blockquote><p>给40亿个不重复的unsigned int的整数，没排过序的，然后再给一个数，如何快速判断这个数是否在那40亿个数当中？</p></blockquote>

<h3>Analysis</h3>

<p>Categorized under <strong>BitMap</strong>.</p>

<p>There&rsquo;re 4.3 billion unsigned integers in Java. This is a perfect question to use BitMap.</p>

<p>申请512M的内存，一个bit位代表一个unsigned int值。读入40亿个数，设置相应的bit位，读入要查询的数，查看相应bit位是否为1，为1表示存在，为0表示不存在。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/10/big-data-Remove-Duplicate-Numbers/">[Design] Big Data - Remove Duplicate Numbers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-10T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/10/big-data-Remove-Duplicate-Numbers/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/10/big-data-Remove-Duplicate-Numbers/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://blog.csdn.net/v_JULY_v/article/details/6279498">link</a></p>

<blockquote><p>2.5亿个整数中找出不重复的整数的个数，内存空间不足以容纳这2.5亿个整数。</p></blockquote>

<h3>Analysis</h3>

<p>Categorized under <strong>双层桶划分</strong> or <strong>BitMap</strong>.</p>

<p>整数个数为2<sup>32</sup>,也就是，我们可以将这2<sup>32</sup>个数，划分为2<sup>8</sup>个区域(比如用单个文件代表一个区域)，然后将数据分离到不同的区域，然后不同的区域在利用bitmap就可以直接解决了。</p>

<p><strong>But how exactly to use BitMap</strong>? 将bit-map扩展一下，用2bit表示一个数即可，0表示未出现，1表示出现一次，2表示出现2次及以上。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/09/Test-command-line-copy/">[Testing] Test Command Line Copy</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/09/Test-command-line-copy/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/09/Test-command-line-copy/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://stackoverflow.com/questions/6591652/how-do-i-test-the-copy-command-in-the-windows-environment">link</a></p>

<blockquote><p>testing the copy command in windows environment</p></blockquote>

<h3>Solution</h3>

<p><a href="http://stackoverflow.com/a/6591999">The most important point</a> is to <strong>come up with different domains of inputs and scenarios</strong>.</p>

<h3>Copying between:</h3>

<ol>
<li>network share</li>
<li>A really slow network share across the Internet</li>
<li>partitions</li>
<li>disks</li>
<li>disks of different types (flash, usb, external sata, SSD, etc&hellip;)</li>
<li>directories</li>
<li>within the same directory</li>
</ol>


<h3>Naming</h3>

<ol>
<li>Normal file name</li>
<li>Filename that exceeds 8.3 (verylongfilename.whatever)</li>
<li>Copying a very long file name, but referencing it by it&rsquo;s 8.3 name (copy verylo~1.wha d:)</li>
<li>A full directory path that exeeds MAX_PATH (260) characters (e.g. c:\a\very\long\directory\name\that\goes\on\forever\in\length&hellip;&hellip;foo.txt)</li>
<li>By absolute addressing (\?\c:\foo\foo.txt)</li>
<li>wildcards (e.g. <em>.</em> *.txt foo?.txt )</li>
<li>A filename with unicode characters</li>
<li>A filename with illegal characters in it (there are creative ways to get these files on disk)</li>
</ol>


<h3>Attributes</h3>

<ol>
<li>Testing with different file attributes (read-only, hidden, system, archive, etc&hellip;)</li>
<li>Validate timestamp is preserved across copies</li>
<li>Validate timestamp is preserved across network file share copies when the destination machine is in another timezone</li>
<li>NTFS ACLs are preserved</li>
</ol>


<h3>Addressing types</h3>

<ol>
<li>reference by absolute path (e.g. copy c:\some\directory\foo.txt c:\other\place\foo.txt)</li>
<li>reference by relative path (e.g. copy &#8230;.\documents\whatever\foo.txt subdirectory/foo.txt)</li>
<li>By absolute drive letter into current working directoroy of destination (with no path (e.g. copy foo.txt d:)</li>
<li>Network share mounted to a drive letter</li>
</ol>


<h3>Failure cases, edge cases, and hack attacks</h3>

<ol>
<li>Try to copy a file onto itself (e.g copy c:\foo.txt c:\foo.txt)</li>
<li>Copy when the network share is down.</li>
<li>Unplug the network cable in the middle of a network file copy</li>
<li>copy to a read only directory</li>
<li>copy when the source file is locked.</li>
<li>copy the when destination file exists but the destination file exists and is read only</li>
<li>Detach the external disk right before the file copy starts</li>
<li>disk is near full (But would be full before the entire copy finishes)</li>
<li>disk is full</li>
<li>Unplug the power cable in the middle of the copy!</li>
<li>During a very long copy, start another copy with the same source file, but to another destination</li>
<li>During a very long copy, start another copy with a different source file, but the the same destination</li>
<li>During a very long copy, start another copy with the same source and destination files!</li>
</ol>


<h3>File types</h3>

<ol>
<li>ascii file</li>
<li>unicode file</li>
<li>binary file</li>
</ol>


<h3>Environments</h3>

<ol>
<li>RAID configurations</li>
<li>FAT and NTFS</li>
<li>Windows XP, Vista, 7, Server 2003, etc&hellip; (you can quantify this by asking the requirement of &ldquo;which OS&rdquo; up front)</li>
<li>Virtual Machine (VMWare, virtual PC, hypervisor, etc&hellip;)</li>
<li>Intel and AMD</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/09/Process-and-thread/">[Design] Process vs. Thread</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/09/Process-and-thread/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/09/Process-and-thread/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>First difference</h3>

<p><strong><a href="http://www.programmerinterview.com/index.php/operating-systems/thread-vs-process/">A process</a> can contain multiple threads</strong>. When you open Microsoft Word, you start <strong>a process</strong> that runs Word. The OS creates a process and begins executing the <strong>primary thread</strong> of that process.</p>

<p>Since a process can consist of multiple threads, a thread could be considered <strong>a ‘lightweight’ process</strong>.</p>

<h3>Second difference</h3>

<p>Another difference is that <strong>threads</strong> within the same process <strong>share the same address space</strong>, whereas different <strong>processes</strong> do not.</p>

<p>This allows threads to read from and write to the same data structures and variables, and also <strong>facilitates communication between threads</strong>. Communication between processes – also known as IPC, or <strong>inter-process communication</strong> – is quite difficult and resource-intensive.</p>

<h3>One more thing</h3>

<p>We already know that all thread under same process share same address space. <strong>Let&rsquo;s talk a little about Stack and Heap in RAM</strong>.</p>

<p>Each thread gets <strong>its own Stack</strong>, while sharing <strong>the same Heap</strong>. Stack size is fixed. Stack is reclaimed when thread ends.</p>

<p>Heap allocation is customized by <strong>heap allocator</strong>. There&rsquo;s no rules. Heap size can be expanded, if approved by the OS.</p>

<p>As Heap holds global resources, it must be <strong>thread-safe</strong>, thus making it very complex to manage. For more, refer to <strong>[Design] Stack and Heap</strong>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/09/Median-in-distributed-computers/">[Design] Median of Array in Distributed Computers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/09/Median-in-distributed-computers/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/09/Median-in-distributed-computers/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://www.quora.com/Distributed-Algorithms/What-is-the-distributed-algorithm-to-determine-the-median-of-arrays-of-integers-located-on-different-computers">link</a></p>

<blockquote><p>What is the <strong>distributed algorithm</strong> to determine the median of arrays of 1 billion integers located on different computers?</p></blockquote>

<h3>Solution</h3>

<ol>
<li><p>Suppose you have <strong>a master node</strong> (or are able to use a consensus protocol to elect a master from among your servers).</p></li>
<li><p>The master queries all servers for the size of their sets of data, so that it knows to look for the k = n/2 largest element.</p></li>
<li><p>The master then selects a random server and queries <strong>a random element</strong>.</p></li>
<li><p>The master broadcasts this element to each server.</p></li>
<li><p>Each server partitions its elements into those larger than or equal to the broadcasted element and those smaller than the broadcasted element.</p></li>
<li><p>Each server returns to the master the <strong>size of the larger-than partition</strong>, call this m.</p>

<ol>
<li><p>If the sum of these sizes is greater than k, the master indicates to each server to disregard the &lsquo;less-than&rsquo; set.</p></li>
<li><p>If it is less than k, the master indicates to disregard the larger-than sets and updates k = k &ndash; m.</p></li>
<li><p>If it is exactly k, the algorithm terminates and the value returned is the pivot selected at the beginning of the iteration.</p></li>
</ol>
</li>
<li><p>Recurse beginning with selecting a new random pivot from the remaining elements.</p></li>
</ol>


<p><a href="http://qr.ae/k2DcS">ref</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/09/Functional-programming/">[Design] Functional Programming</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-09T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/09/Functional-programming/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/09/Functional-programming/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Overview</h3>

<p><strong><a href="http://stackoverflow.com/a/23290">A functional language</a> allows you to write a mathematical function</strong>, i.e. a function that takes n arguments and returns a value. If the program is executed, this function is evaluated.</p>

<p>A purely functional program <strong>always yields the same value for an input</strong>, and the order of evaluation is not well-defined; which means that uncertain values like user input or random values are hard to model in purely functional languages.</p>

<h3>One Sentence</h3>

<p><strong>Functional programming is like describing your <a href="http://stackoverflow.com/a/23475">problem to a mathematician</a>. Imperative programming is like giving instructions to an idiot</strong>.</p>

<h3>Pros and Cons</h3>

<p>Functional Programming allows coding <a href="http://stackoverflow.com/a/24294">with fewer potentials for bugs</a> because each component is completely isolated. Also, using recursion and first-class functions allows for <strong>simple proofs of correctness</strong> which typically mirror the structure of the code.</p>

<p>Functional programming languages are typically <a href="http://en.wikipedia.org/wiki/Functional_programming#Efficiency_issues">less efficient</a> in their use of CPU and memory than imperative languages such as C and Pascal.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/08/Thread-pool-pattern/">[Java OOP] Thread Pool Pattern</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/08/Thread-pool-pattern/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/08/Thread-pool-pattern/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Overview</h3>

<p><a href="http://programmers.stackexchange.com/a/173580">Thread pool</a> is a collection of managed threads usually organized in a queue, which execute the tasks in the task queue.</p>

<p>Thread pool is a group of pre-instantiated, idle threads which stand ready to be given work.</p>

<p><img class="middle" src="/assets/images/thread-pool.png"></p>

<p><a href="http://en.wikipedia.org/wiki/Thread_pool_pattern">A sample thread pool</a> (green boxes) with waiting tasks (blue) and completed tasks (yellow)</p>

<h3>Why Thread Pool?</h3>

<p><strong>Thread Pools are useful when you need to limit the number of threads</strong> running in your application at the same time.</p>

<p>Thread pools are often used in multi threaded servers. Each connection <strong>arriving at the server via the network is wrapped as a task</strong> and passed on to a thread pool. The threads in the thread pool will process the requests on the connections concurrently.</p>

<blockquote><p><a href="http://www.ibm.com/developerworks/library/j-jtp0730/">Many server applications</a>, such as <strong>Web servers (eg. Tomcat)</strong>, database servers, file servers, or mail servers must process a large number of tasks received from a network protocol. Often, the task is short-lived and the number of requests is large.</p>

<p>Instead of starting a new thread for every task to execute concurrently, the <strong>task can be passed to a thread pool</strong>. As soon as the pool has any idle threads the task is assigned to one of them and executed.</p></blockquote>

<h3>Implementation</h3>

<p>This is a <a href="http://tutorials.jenkov.com/java-concurrency/thread-pools.html">simple thread pool implementation</a>. The pool is implemented using a list of tasks, and a list of threads. Theads will fetch tasks and run it. The list is implemented with a BlockingQueue &ndash; however, it&rsquo;s fine to use just a normal queue.</p>

<p>Main Class:</p>

<pre><code>public class Main {

    public static void main(String[] args) {

        // In this example, we create 3 thread to run 10 tasks
        // set the BlockingQ size to be 5.

        ThreadPool tp = new ThreadPool(3, 5);

        List&lt;MyTask&gt; todoList = new ArrayList&lt;MyTask&gt;();
        for (int i = 1; i &lt;= 10; i++) {
            todoList.add(new MyTask("T" + i));
        }

        for (MyTask todo : todoList) {
            tp.execute(todo);
        }

        while (!tp.noMoreTask()) {
            try {
                Thread.sleep(2000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        tp.stop();
    }

}
</code></pre>

<p>Pool Class:</p>

<pre><code>public class ThreadPool {

    // a list of tasks (BlockingQueue)
    // a list of thread
    private MyBlockingQueue taskQueue = null;
    private List&lt;MyThread&gt; threads = new ArrayList&lt;MyThread&gt;();
    private boolean isStopped = false;

    public ThreadPool(int numThreads, int maxNumTasks) {
        taskQueue = new MyBlockingQueue(maxNumTasks);

        for (int i = 0; i &lt; numThreads; i++) {
            threads.add(new MyThread(taskQueue));
        }
        System.out.println("Thread pool initiated. ");
        for (MyThread thread : threads) {
            thread.start();
        }
    }

    public synchronized void execute(Runnable task) {
        if (this.isStopped) {
            throw new IllegalStateException("ThreadPool is stopped");
        }

        try {
            this.taskQueue.enqueue(task);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    public boolean noMoreTask() {
        return this.taskQueue.isEmpty();
    }

    public synchronized void stop() {
        this.isStopped = true;
        for (MyThread thread : threads) {
//          thread.stop();
            thread.interrupt();
        }
        System.out.println("Thread pool stopped. ");
    }
}
</code></pre>

<p>Thread Class:</p>

<pre><code>public class MyThread extends Thread {

    private MyBlockingQueue taskQueue = null;
    private boolean isStopped = false;

    public MyThread(MyBlockingQueue queue) {
        taskQueue = queue;
    }

    public void run() {
        while (!isStopped()) {
            try {
                Runnable runnable = (Runnable) taskQueue.dequeue();
                runnable.run();
            } catch (Exception e) {
                // log or otherwise report exception,
                // but keep pool thread alive.
            }
        }
    }

    // public synchronized void stop() {
    // isStopped = true;
    // this.interrupt(); // break pool thread out of dequeue() call.
    // }

    public synchronized boolean isStopped() {
        return isStopped;
    }
}
</code></pre>

<p>Task Class:</p>

<pre><code>public class MyTask implements Runnable {

    String message;

    public MyTask(String s) {
        message = s;
    }

    @Override
    public void run() {
        // do some task here...
        // finish the task ...
        System.out.println("Task finished: " + message);
    }
}
</code></pre>

<p>Output:</p>

<pre><code>Thread pool initiated. 
Task finished: T1
Task finished: T3
Task finished: T4
Task finished: T5
Task finished: T6
Task finished: T2
Task finished: T7
Task finished: T10
Task finished: T9
Task finished: T8
Thread pool stopped. 
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/08/Producer-consumer-problem/">[Design] Producer Consumer Problem</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/08/Producer-consumer-problem/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/08/Producer-consumer-problem/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Overview</h3>

<p>Producer-consumer problem illustrates the need for <strong>synchronization</strong> in systems where <strong>many processes share a resource</strong>.</p>

<p><a href="http://cs.gmu.edu/cne/modules/ipc/aqua/producer.html">In the problem</a>, two processes share a fixed-size buffer. One process produces information and puts it in the buffer, while the other process consumes information from the buffer. These processes do not take turns accessing the buffer, they both work concurrently.</p>

<h3>Inadequate Solution</h3>

<p><img class="middle" src="/assets/images/producer-workflow.gif"></p>

<p><img class="middle" src="/assets/images/consumer-workflow.gif"></p>

<p><strong>The code might look like this</strong>:</p>

<pre><code>BufferSize = 3;
count = 0;

Producer()
{
    int widget;
    WHILE (true) {                     // loop forever
       make_new(widget);               // create a new widget to put in the buffer
       IF(count==BufferSize)
           Sleep();                    // if the buffer is full, sleep
       put_item(widget);               // put the item in the buffer
       count = count + 1;              // increment count of items
       IF (count==1)
           Wakeup(Consumer);           // if the buffer was previously empty, wake
    }                                  //  the consumer
}

Consumer()
{
    int widget;
    WHILE(true) {                    // loop forever
      IF(count==0)
           Sleep();                  // if the buffer is empty, sleep
      remove_item(widget);           // take an item from the buffer
      count = count + 1;             // decrement count of items
      IF(count==N-1)
            Wakeup(Producer);        // if buffer was previously full, wake
                                     //  the producer
      Consume_item(widget);          // consume the item
    }
}
</code></pre>

<p>This <a href="http://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem#Inadequate_implementation">will cause problems</a>, because <strong>it contains a race condition</strong> that can lead to a deadlock. Or in simply words, it has the potential of <a href="http://cs.gmu.edu/cne/modules/ipc/purple/prodsem.html">losing wakeups</a>.</p>

<p>An alternative analysis is that if the programming language does not define the semantics of <strong>concurrent accesses to shared variables (in this case itemCount)</strong> without use of synchronization, then the solution is unsatisfactory for that reason, without needing to explicitly demonstrate a race condition.</p>

<p>Solutions are: <strong>semaphores or monitors</strong>.</p>

<h3>Semaphore</h3>

<pre><code>semaphore mutex = 1;
semaphore fillCount = 0;
semaphore emptyCount = BUFFER_SIZE;

procedure producer() {
    while (true) {
        item = produceItem();
        down(emptyCount);
            down(mutex);
                putItemIntoBuffer(item);
            up(mutex);
        up(fillCount);
    }
}

procedure consumer() {
    while (true) {
        down(fillCount);
            down(mutex);
                item = removeItemFromBuffer();
            up(mutex);
        up(emptyCount);
        consumeItem(item);
    }
}
</code></pre>

<h3>Monitor</h3>

<pre><code>monitor ProducerConsumer {
    int itemCount;
    condition full;
    condition empty;

    procedure add(item) {
        while (itemCount == BUFFER_SIZE) {
            wait(full);
        }

        putItemIntoBuffer(item);
        itemCount = itemCount + 1;

        if (itemCount == BUFFER_SIZE -1) {
            notify(full);
        }
    }
    procedure remove() {
        while (itemCount == 0) {
            wait(empty);
        }

        item = removeItemFromBuffer();
        itemCount = itemCount - 1;

        if (itemCount == 1) {
            notify(empty);
        }


        return item;
    }
}

procedure producer() {
    while (true) {
        item = produceItem();
        ProducerConsumer.add(item);
    }
}

procedure consumer() {
    while (true) {
        item = ProducerConsumer.remove();
        consumeItem(item);
    }
}
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/08/Max-sum-non-consecutive/">[Question] Max Sum of Non-Consecutive Elements</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-08T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/08/Max-sum-non-consecutive/#disqus_thread"
             data-disqus-identifier="http://okckd.github.io/blog/2014/08/08/Max-sum-non-consecutive/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Question</h3>

<p><a href="http://tech-queries.blogspot.sg/2009/05/max-possible-sum-of-non-consecutive.html">link</a></p>

<blockquote><p>There is an integer array consisting positive numbers only.</p>

<p>Find maximum possible sum of elements such that there are no 2 consecutive elements present in the sum.</p></blockquote>

<h3>Solution</h3>

<p>It&rsquo;s a little tricky to write the equation. Always remember the <strong>basic principle of DP</strong> is to assume that solution is found for (i -1), and then we calculate solution for input (i).</p>

<p><strong>Don&rsquo;t miss the (i-1) part</strong>.</p>

<h3>Code</h3>

<p><strong>written by me</strong></p>

<pre><code>public int maxSumNonConsec(int[] input) {
    int len = input.length;
    int[] dp = new int[len];
    dp[0] = input[0];
    dp[1] = Math.max(input[0], input[1]);
    for (int i = 2; i &lt; len; i++) {
        dp[i] = Math.max(dp[i - 1], input[i] + dp[i - 2]);
    }
    return dp[len - 1];
}
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/21">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/19">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class="well">
  <h1>Categories</h1>
  <ul id="categories" class="nav nav-list">
    <li class='category'><a href='/blog/categories/cc150v4/'>cc150v4 (34)</a></li>
<li class='category'><a href='/blog/categories/cc150v5/'>cc150v5 (28)</a></li>
<li class='category'><a href='/blog/categories/design/'>design (60)</a></li>
<li class='category'><a href='/blog/categories/experience/'>experience (3)</a></li>
<li class='category'><a href='/blog/categories/facebook/'>facebook (9)</a></li>
<li class='category'><a href='/blog/categories/fundamental/'>fundamental (10)</a></li>
<li class='category'><a href='/blog/categories/google/'>google (47)</a></li>
<li class='category'><a href='/blog/categories/java-oop/'>java oop (25)</a></li>
<li class='category'><a href='/blog/categories/leetcode/'>leetcode (153)</a></li>
<li class='category'><a href='/blog/categories/leetcode-plus/'>leetcode_plus (9)</a></li>
<li class='category'><a href='/blog/categories/lintcode/'>lintcode (11)</a></li>
<li class='category'><a href='/blog/categories/ninechap/'>ninechap (15)</a></li>
<li class='category'><a href='/blog/categories/question/'>question (104)</a></li>
<li class='category'><a href='/blog/categories/string-search/'>string search (17)</a></li>
<li class='category'><a href='/blog/categories/testing/'>testing (7)</a></li>
<li class='category'><a href='/blog/categories/top-k/'>top k (7)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/28/two-dimensional-knapsack-problem/">[Question] Two Dimensional Knapsack Problem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/28/speed-up-web-page-2/">[Design] Speed Up Webpage for Slow Connection (2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/28/speed-up-web-page-1/">[Design] Speed Up Webpage for Slow Connection (1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/28/implement-trie-suffix-tree/">[Fundamental] Implement Trie and Suffix Tree</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/27/suffix-tree/">[Fundamental] Suffix Tree</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Charlie Brown -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'woodstockblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
